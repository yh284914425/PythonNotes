# 04-æ‰“åŒ…åŸºç¡€

## ğŸ“¦ Pythonæ‰“åŒ…æ¦‚è¿°

### ä»€ä¹ˆæ˜¯Pythonæ‰“åŒ…ï¼Ÿ
Pythonæ‰“åŒ…æ˜¯å°†ä½ çš„ä»£ç ã€ä¾èµ–å’Œå…ƒæ•°æ®ç»„ç»‡æˆå¯åˆ†å‘æ ¼å¼çš„è¿‡ç¨‹ï¼Œä½¿å…¶ä»–äººèƒ½å¤Ÿè½»æ¾å®‰è£…å’Œä½¿ç”¨ä½ çš„ä»£ç ã€‚

### æ‰“åŒ…çš„ç›®çš„
```python
packaging_purposes = {
    "ä»£ç åˆ†å‘": "è®©å…¶ä»–äººèƒ½å¤Ÿå®‰è£…å’Œä½¿ç”¨ä½ çš„ä»£ç ",
    "ä¾èµ–ç®¡ç†": "è‡ªåŠ¨å¤„ç†é¡¹ç›®çš„ä¾èµ–å…³ç³»",
    "ç‰ˆæœ¬æ§åˆ¶": "ç®¡ç†ä¸åŒç‰ˆæœ¬çš„å‘å¸ƒ",
    "è·¨å¹³å°": "åœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¸Šè¿è¡Œ",
    "æ ‡å‡†åŒ–": "éµå¾ªPythonç¤¾åŒºæ ‡å‡†",
    "è‡ªåŠ¨åŒ–": "ç®€åŒ–å®‰è£…å’Œéƒ¨ç½²è¿‡ç¨‹"
}
```

### PythonåŒ…çš„ç±»å‹
```python
package_types = {
    "æºç åŒ…": {
        "æ ¼å¼": ".tar.gz",
        "ç‰¹ç‚¹": "åŒ…å«æºä»£ç ï¼Œéœ€è¦ç¼–è¯‘",
        "é€‚ç”¨": "çº¯PythonåŒ…æˆ–éœ€è¦ç¼–è¯‘çš„åŒ…"
    },
    "äºŒè¿›åˆ¶åŒ…": {
        "æ ¼å¼": ".whl (wheel)",
        "ç‰¹ç‚¹": "é¢„ç¼–è¯‘ï¼Œå®‰è£…å¿«é€Ÿ",
        "é€‚ç”¨": "åŒ…å«Cæ‰©å±•æˆ–é¢„ç¼–è¯‘çš„åŒ…"
    },
    "å¼€å‘åŒ…": {
        "æ ¼å¼": "å¯ç¼–è¾‘å®‰è£…",
        "ç‰¹ç‚¹": "ç›´æ¥é“¾æ¥åˆ°æºç ç›®å½•",
        "é€‚ç”¨": "å¼€å‘é˜¶æ®µä½¿ç”¨"
    }
}
```

## ğŸ—ï¸ åŒ…çš„åŸºæœ¬ç»“æ„

### æœ€å°åŒ…ç»“æ„
```
my_package/
â”œâ”€â”€ setup.py              # å®‰è£…è„šæœ¬ï¼ˆä¼ ç»Ÿï¼‰
â”œâ”€â”€ pyproject.toml        # é¡¹ç›®é…ç½®ï¼ˆç°ä»£ï¼‰
â”œâ”€â”€ README.md             # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ LICENSE              # è®¸å¯è¯
â””â”€â”€ my_package/          # åŒ…æºç 
    â”œâ”€â”€ __init__.py      # åŒ…åˆå§‹åŒ–
    â””â”€â”€ module.py        # æ¨¡å—ä»£ç 
```

### å®Œæ•´åŒ…ç»“æ„
```
my_project/
â”œâ”€â”€ pyproject.toml       # é¡¹ç›®é…ç½®
â”œâ”€â”€ setup.py            # å®‰è£…è„šæœ¬ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ setup.cfg           # é…ç½®æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ README.md           # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ LICENSE             # è®¸å¯è¯
â”œâ”€â”€ CHANGELOG.md        # æ›´æ–°æ—¥å¿—
â”œâ”€â”€ MANIFEST.in         # åŒ…å«æ–‡ä»¶æ¸…å•
â”œâ”€â”€ requirements.txt    # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ src/                # æºç ç›®å½•ï¼ˆæ¨èï¼‰
â”‚   â””â”€â”€ my_package/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ core.py
â”‚       â””â”€â”€ utils.py
â”œâ”€â”€ tests/              # æµ‹è¯•ä»£ç 
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_core.py
â”‚   â””â”€â”€ test_utils.py
â”œâ”€â”€ docs/               # æ–‡æ¡£
â”‚   â”œâ”€â”€ index.md
â”‚   â””â”€â”€ api.md
â””â”€â”€ examples/           # ç¤ºä¾‹ä»£ç 
    â””â”€â”€ basic_usage.py
```

## ğŸ“„ åŒ…çš„å…ƒæ•°æ®

### åŸºæœ¬å…ƒæ•°æ®
```python
# åŒ…çš„åŸºæœ¬ä¿¡æ¯
package_metadata = {
    "name": "my-awesome-package",      # åŒ…åï¼ˆPyPIä¸Šå”¯ä¸€ï¼‰
    "version": "1.0.0",               # ç‰ˆæœ¬å·
    "description": "ç®€çŸ­æè¿°",         # ä¸€å¥è¯æè¿°
    "long_description": "è¯¦ç»†æè¿°",    # è¯¦ç»†æè¿°ï¼ˆé€šå¸¸æ¥è‡ªREADMEï¼‰
    "author": "ä½œè€…å§“å",              # ä½œè€…
    "author_email": "email@example.com", # ä½œè€…é‚®ç®±
    "url": "https://github.com/user/repo", # é¡¹ç›®ä¸»é¡µ
    "license": "MIT",                 # è®¸å¯è¯
    "python_requires": ">=3.8",      # Pythonç‰ˆæœ¬è¦æ±‚
}
```

### åˆ†ç±»ä¿¡æ¯
```python
# PyPIåˆ†ç±»å™¨
classifiers = [
    # å¼€å‘çŠ¶æ€
    "Development Status :: 4 - Beta",
    
    # ç›®æ ‡å—ä¼—
    "Intended Audience :: Developers",
    "Intended Audience :: Science/Research",
    
    # è®¸å¯è¯
    "License :: OSI Approved :: MIT License",
    
    # ç¼–ç¨‹è¯­è¨€
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.8",
    "Programming Language :: Python :: 3.9",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
    
    # æ“ä½œç³»ç»Ÿ
    "Operating System :: OS Independent",
    
    # ä¸»é¢˜
    "Topic :: Software Development :: Libraries :: Python Modules",
    "Topic :: Scientific/Engineering",
]
```

### ä¾èµ–ç®¡ç†
```python
# ä¾èµ–ç±»å‹
dependencies = {
    "install_requires": [
        "requests>=2.25.0",      # è¿è¡Œæ—¶ä¾èµ–
        "click>=7.0",
        "pydantic>=1.8.0",
    ],
    "extras_require": {
        "dev": [                 # å¼€å‘ä¾èµ–
            "pytest>=6.0",
            "black>=22.0",
            "flake8>=4.0",
        ],
        "docs": [                # æ–‡æ¡£ä¾èµ–
            "sphinx>=4.0",
            "sphinx-rtd-theme",
        ],
        "test": [                # æµ‹è¯•ä¾èµ–
            "pytest>=6.0",
            "pytest-cov>=3.0",
        ],
    },
    "python_requires": ">=3.8", # Pythonç‰ˆæœ¬è¦æ±‚
}
```

## ğŸ”§ æ„å»ºå·¥å…·

### setuptoolsï¼ˆä¼ ç»Ÿå·¥å…·ï¼‰
```python
# setup.py ç¤ºä¾‹
from setuptools import setup, find_packages

with open("README.md", "r", encoding="utf-8") as fh:
    long_description = fh.read()

setup(
    name="my-package",
    version="1.0.0",
    author="Your Name",
    author_email="your.email@example.com",
    description="A short description",
    long_description=long_description,
    long_description_content_type="text/markdown",
    url="https://github.com/yourusername/my-package",
    packages=find_packages(),
    classifiers=[
        "Programming Language :: Python :: 3",
        "License :: OSI Approved :: MIT License",
        "Operating System :: OS Independent",
    ],
    python_requires=">=3.8",
    install_requires=[
        "requests>=2.25.0",
    ],
    extras_require={
        "dev": ["pytest>=6.0", "black", "flake8"],
    },
    entry_points={
        "console_scripts": [
            "my-tool=my_package.cli:main",
        ],
    },
)
```

### buildï¼ˆç°ä»£æ„å»ºå·¥å…·ï¼‰
```bash
# å®‰è£…buildå·¥å…·
pip install build

# æ„å»ºåŒ…
python -m build

# åªæ„å»ºwheel
python -m build --wheel

# åªæ„å»ºæºç åŒ…
python -m build --sdist

# æŒ‡å®šè¾“å‡ºç›®å½•
python -m build --outdir dist/
```

### wheelæ ¼å¼
```python
# wheelçš„ä¼˜åŠ¿
wheel_advantages = {
    "å®‰è£…å¿«é€Ÿ": "é¢„ç¼–è¯‘ï¼Œæ— éœ€æ„å»ºæ­¥éª¤",
    "è·¨å¹³å°": "æ”¯æŒä¸åŒå¹³å°çš„äºŒè¿›åˆ¶åŒ…",
    "ç¼“å­˜å‹å¥½": "pipå¯ä»¥ç¼“å­˜wheelæ–‡ä»¶",
    "æ ‡å‡†æ ¼å¼": "Pythonå®˜æ–¹æ¨èçš„åˆ†å‘æ ¼å¼",
    "å…ƒæ•°æ®ä¸°å¯Œ": "åŒ…å«å®Œæ•´çš„åŒ…å…ƒæ•°æ®"
}

# wheelæ–‡ä»¶å‘½å
# {package}-{version}(-{build tag})?-{python tag}-{abi tag}-{platform tag}.whl
wheel_naming = {
    "package": "åŒ…å",
    "version": "ç‰ˆæœ¬å·",
    "build_tag": "æ„å»ºæ ‡ç­¾ï¼ˆå¯é€‰ï¼‰",
    "python_tag": "Pythonç‰ˆæœ¬æ ‡ç­¾",
    "abi_tag": "ABIæ ‡ç­¾",
    "platform_tag": "å¹³å°æ ‡ç­¾"
}

# ç¤ºä¾‹ï¼šrequests-2.28.1-py3-none-any.whl
```

## ğŸ“‹ MANIFEST.inæ–‡ä»¶

### MANIFEST.inçš„ä½œç”¨
MANIFEST.inæ–‡ä»¶æŒ‡å®šå“ªäº›æ–‡ä»¶åº”è¯¥åŒ…å«åœ¨æºç åˆ†å‘åŒ…ä¸­ã€‚

### MANIFEST.inè¯­æ³•
```
# MANIFEST.in ç¤ºä¾‹

# åŒ…å«æ–‡ä»¶
include README.md
include LICENSE
include CHANGELOG.md
include requirements.txt

# åŒ…å«ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶
recursive-include docs *.md *.rst
recursive-include examples *.py

# åŒ…å«ç‰¹å®šæ¨¡å¼çš„æ–‡ä»¶
include my_package/data/*.json
include my_package/templates/*.html

# æ’é™¤æ–‡ä»¶
exclude .gitignore
exclude .env

# æ’é™¤ç›®å½•
prune tests/
prune .git/

# å…¨å±€æ’é™¤æ¨¡å¼
global-exclude *.pyc
global-exclude __pycache__
global-exclude .DS_Store
```

### å¸¸ç”¨MANIFEST.inæ¨¡æ¿
```
# åŸºæœ¬æ–‡ä»¶
include README.md
include LICENSE
include CHANGELOG.md
include pyproject.toml
include setup.py
include setup.cfg

# éœ€æ±‚æ–‡ä»¶
include requirements*.txt

# æ•°æ®æ–‡ä»¶
recursive-include my_package/data *
recursive-include my_package/templates *
recursive-include my_package/static *

# æ–‡æ¡£
recursive-include docs *.md *.rst *.txt

# ç¤ºä¾‹
recursive-include examples *.py

# æ’é™¤å¼€å‘æ–‡ä»¶
exclude .gitignore
exclude .pre-commit-config.yaml
exclude tox.ini
exclude Makefile

# æ’é™¤æµ‹è¯•å’Œæ„å»ºæ–‡ä»¶
prune tests/
prune .git/
prune .github/
prune build/
prune dist/
prune *.egg-info/

# æ’é™¤ç¼“å­˜æ–‡ä»¶
global-exclude *.pyc
global-exclude __pycache__
global-exclude .DS_Store
global-exclude *.so
```

## ğŸ¯ ç‰ˆæœ¬ç®¡ç†

### è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶
```python
# SemVeræ ¼å¼ï¼šMAJOR.MINOR.PATCH
semantic_versioning = {
    "MAJOR": "ä¸å…¼å®¹çš„APIä¿®æ”¹",
    "MINOR": "å‘åå…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢", 
    "PATCH": "å‘åå…¼å®¹çš„é—®é¢˜ä¿®æ­£"
}

# ç‰ˆæœ¬ç¤ºä¾‹
version_examples = {
    "1.0.0": "é¦–ä¸ªç¨³å®šç‰ˆæœ¬",
    "1.1.0": "æ–°å¢åŠŸèƒ½ï¼Œå‘åå…¼å®¹",
    "1.1.1": "ä¿®å¤bugï¼Œå‘åå…¼å®¹",
    "2.0.0": "é‡å¤§æ›´æ–°ï¼Œå¯èƒ½ä¸å…¼å®¹",
    "2.0.0-alpha.1": "é¢„å‘å¸ƒç‰ˆæœ¬",
    "2.0.0-beta.1": "æµ‹è¯•ç‰ˆæœ¬",
    "2.0.0-rc.1": "å‘å¸ƒå€™é€‰ç‰ˆæœ¬"
}
```

### åŠ¨æ€ç‰ˆæœ¬ç®¡ç†
```python
# ä½¿ç”¨setuptools_scmä»Gitæ ‡ç­¾è·å–ç‰ˆæœ¬
# pyproject.toml
"""
[build-system]
requires = ["setuptools>=45", "setuptools_scm[toml]>=6.2"]

[tool.setuptools_scm]
write_to = "my_package/_version.py"
"""

# åœ¨ä»£ç ä¸­ä½¿ç”¨ç‰ˆæœ¬
# my_package/__init__.py
try:
    from ._version import version as __version__
except ImportError:
    __version__ = "unknown"
```

## ğŸ” åŒ…éªŒè¯

### æ£€æŸ¥åŒ…ç»“æ„
```bash
# ä½¿ç”¨check-manifestæ£€æŸ¥MANIFEST.in
pip install check-manifest
check-manifest

# ä½¿ç”¨twineæ£€æŸ¥åŒ…
pip install twine
twine check dist/*

# ä½¿ç”¨setup.pyæ£€æŸ¥
python setup.py check --strict --metadata
```

### æµ‹è¯•å®‰è£…
```bash
# æœ¬åœ°å®‰è£…æµ‹è¯•
pip install -e .

# ä»æ„å»ºçš„åŒ…å®‰è£…
pip install dist/my_package-1.0.0-py3-none-any.whl

# åœ¨æ–°ç¯å¢ƒä¸­æµ‹è¯•
python -m venv test_env
source test_env/bin/activate
pip install dist/my_package-1.0.0.tar.gz
python -c "import my_package; print(my_package.__version__)"
```

## ğŸ¯ æœ¬èŠ‚å°ç»“

- **æ‰“åŒ…æ¦‚å¿µ**ï¼šç†è§£Pythonæ‰“åŒ…çš„ç›®çš„å’Œé‡è¦æ€§
- **åŒ…ç»“æ„**ï¼šæŒæ¡æ ‡å‡†çš„åŒ…ç›®å½•ç»“æ„
- **å…ƒæ•°æ®ç®¡ç†**ï¼šæ­£ç¡®è®¾ç½®åŒ…çš„å…ƒæ•°æ®ä¿¡æ¯
- **æ„å»ºå·¥å…·**ï¼šä½¿ç”¨ç°ä»£å·¥å…·æ„å»ºåŒ…
- **ç‰ˆæœ¬ç®¡ç†**ï¼šé‡‡ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶

## ğŸ’¡ å…³é”®è¦ç‚¹

1. **ç»“æ„è§„èŒƒ**ï¼šéµå¾ªPythonåŒ…çš„æ ‡å‡†ç»“æ„
2. **å…ƒæ•°æ®å®Œæ•´**ï¼šæä¾›å®Œæ•´å‡†ç¡®çš„åŒ…å…ƒæ•°æ®
3. **ä¾èµ–æ˜ç¡®**ï¼šæ¸…æ™°å£°æ˜åŒ…çš„ä¾èµ–å…³ç³»
4. **ç‰ˆæœ¬è¯­ä¹‰**ï¼šä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶
5. **æµ‹è¯•éªŒè¯**ï¼šæ„å»ºåè¿›è¡Œå……åˆ†æµ‹è¯•

## ğŸ“š å»¶ä¼¸é˜…è¯»
- [Pythonæ‰“åŒ…ç”¨æˆ·æŒ‡å—](https://packaging.python.org/)
- [setuptoolsæ–‡æ¡£](https://setuptools.pypa.io/)
- [wheelæ ¼å¼è§„èŒƒ](https://peps.python.org/pep-0427/)
- [è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶](https://semver.org/)
