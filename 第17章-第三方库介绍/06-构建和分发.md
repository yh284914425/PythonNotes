# 06-æ„å»ºå’Œåˆ†å‘

## ğŸ—ï¸ æ„å»ºè¿‡ç¨‹æ¦‚è¿°

### ä»€ä¹ˆæ˜¯æ„å»ºï¼Ÿ
æ„å»ºæ˜¯å°†æºä»£ç è½¬æ¢ä¸ºå¯åˆ†å‘æ ¼å¼çš„è¿‡ç¨‹ï¼ŒåŒ…æ‹¬ï¼š
- **æºç åŒ…æ„å»º**ï¼šåˆ›å»ºåŒ…å«æºä»£ç çš„.tar.gzæ–‡ä»¶
- **äºŒè¿›åˆ¶åŒ…æ„å»º**ï¼šåˆ›å»ºé¢„ç¼–è¯‘çš„.whlæ–‡ä»¶
- **ä¾èµ–è§£æ**ï¼šç¡®å®šå’ŒéªŒè¯ä¾èµ–å…³ç³»
- **å…ƒæ•°æ®ç”Ÿæˆ**ï¼šåˆ›å»ºåŒ…çš„å…ƒæ•°æ®ä¿¡æ¯

### æ„å»ºäº§ç‰©ç±»å‹
```python
build_artifacts = {
    "æºç åˆ†å‘åŒ…": {
        "æ ¼å¼": ".tar.gz (sdist)",
        "å†…å®¹": "æºä»£ç  + å…ƒæ•°æ®",
        "ç‰¹ç‚¹": "éœ€è¦åœ¨å®‰è£…æ—¶ç¼–è¯‘",
        "é€‚ç”¨": "çº¯PythonåŒ…æˆ–éœ€è¦ç¼–è¯‘çš„åŒ…"
    },
    "äºŒè¿›åˆ¶åˆ†å‘åŒ…": {
        "æ ¼å¼": ".whl (wheel)",
        "å†…å®¹": "é¢„ç¼–è¯‘ä»£ç  + å…ƒæ•°æ®",
        "ç‰¹ç‚¹": "å®‰è£…å¿«é€Ÿï¼Œæ— éœ€ç¼–è¯‘",
        "é€‚ç”¨": "æ‰€æœ‰åŒ…ï¼Œç‰¹åˆ«æ˜¯åŒ…å«Cæ‰©å±•çš„åŒ…"
    }
}
```

## ğŸ”¨ ç°ä»£æ„å»ºå·¥å…·

### build - å®˜æ–¹æ¨èå·¥å…·
```bash
# å®‰è£…buildå·¥å…·
pip install build

# æ„å»ºæ‰€æœ‰æ ¼å¼
python -m build

# åªæ„å»ºwheel
python -m build --wheel

# åªæ„å»ºæºç åŒ…
python -m build --sdist

# æŒ‡å®šè¾“å‡ºç›®å½•
python -m build --outdir custom_dist/

# è¯¦ç»†è¾“å‡º
python -m build --verbose
```

### buildå·¥å…·çš„ä¼˜åŠ¿
```python
build_advantages = {
    "æ ‡å‡†åŒ–": "éµå¾ªPEP 517/518æ ‡å‡†",
    "éš”ç¦»æ„å»º": "åœ¨éš”ç¦»ç¯å¢ƒä¸­æ„å»ºï¼Œé¿å…æ±¡æŸ“",
    "åç«¯æ— å…³": "æ”¯æŒä¸åŒçš„æ„å»ºåç«¯",
    "ç®€å•æ˜“ç”¨": "å‘½ä»¤ç®€å•ï¼Œé…ç½®æœ€å°‘",
    "å®˜æ–¹æ¨è": "Pythonå®˜æ–¹æ¨èçš„æ„å»ºå·¥å…·"
}
```

### æ„å»ºé…ç½®
```toml
# pyproject.tomlä¸­çš„æ„å»ºé…ç½®
[build-system]
requires = [
    "setuptools>=61.0",
    "wheel",
    "setuptools_scm[toml]>=6.2"
]
build-backend = "setuptools.build_meta"

# ä½¿ç”¨ä¸åŒçš„æ„å»ºåç«¯
[build-system]
requires = ["flit_core >=3.2,<4"]
build-backend = "flit_core.buildapi"

# æˆ–è€…ä½¿ç”¨poetry
[build-system]
requires = ["poetry-core"]
build-backend = "poetry.core.masonry.api"
```

## ğŸ“¦ setuptoolsæ„å»º

### ä¼ ç»Ÿæ„å»ºæ–¹å¼
```bash
# ä½¿ç”¨setup.pyæ„å»ºï¼ˆä¸æ¨èï¼‰
python setup.py sdist bdist_wheel

# æ¸…ç†æ„å»ºæ–‡ä»¶
python setup.py clean --all

# æ£€æŸ¥åŒ…
python setup.py check --strict --metadata
```

### setuptoolsé…ç½®
```toml
# pyproject.tomlä¸­çš„setuptoolsé…ç½®
[tool.setuptools]
package-dir = {"" = "src"}
include-package-data = true

[tool.setuptools.packages.find]
where = ["src"]
include = ["my_package*"]
exclude = ["my_package.tests*"]

[tool.setuptools.package-data]
my_package = [
    "data/*.json",
    "templates/*.html",
    "static/css/*.css",
    "static/js/*.js"
]

[tool.setuptools.exclude-package-data]
"*" = ["*.pyc", "__pycache__", "*.so"]
```

### åŠ¨æ€é…ç½®
```python
# åŠ¨æ€ç‰ˆæœ¬è·å–
# my_package/__init__.py
__version__ = "1.0.0"

# pyproject.toml
[tool.setuptools.dynamic]
version = {attr = "my_package.__version__"}
readme = {file = ["README.md"], content-type = "text/markdown"}
```

## ğŸ¯ æ„å»ºæœ€ä½³å®è·µ

### é¡¹ç›®ç»“æ„å»ºè®®
```
my_project/
â”œâ”€â”€ pyproject.toml          # é¡¹ç›®é…ç½®
â”œâ”€â”€ README.md              # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ LICENSE               # è®¸å¯è¯
â”œâ”€â”€ CHANGELOG.md          # æ›´æ–°æ—¥å¿—
â”œâ”€â”€ MANIFEST.in           # åŒ…å«æ–‡ä»¶æ¸…å•
â”œâ”€â”€ src/                  # æºç ç›®å½•ï¼ˆæ¨èï¼‰
â”‚   â””â”€â”€ my_package/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ core.py
â”‚       â””â”€â”€ data/
â”‚           â””â”€â”€ config.json
â”œâ”€â”€ tests/                # æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ test_core.py
â”œâ”€â”€ docs/                 # æ–‡æ¡£ç›®å½•
â””â”€â”€ scripts/              # è„šæœ¬ç›®å½•
```

### MANIFEST.inæœ€ä½³å®è·µ
```
# MANIFEST.in - æ§åˆ¶æºç åŒ…å†…å®¹

# åŒ…å«é‡è¦æ–‡ä»¶
include README.md
include LICENSE
include CHANGELOG.md
include pyproject.toml

# åŒ…å«æ•°æ®æ–‡ä»¶
recursive-include src/my_package/data *.json *.yaml *.txt
recursive-include src/my_package/templates *.html *.jinja2

# åŒ…å«æ–‡æ¡£
recursive-include docs *.md *.rst *.txt

# æ’é™¤ä¸éœ€è¦çš„æ–‡ä»¶
exclude .gitignore
exclude .pre-commit-config.yaml
exclude tox.ini
exclude Makefile

# æ’é™¤ç›®å½•
prune .git
prune .github
prune .pytest_cache
prune build
prune dist
prune *.egg-info

# å…¨å±€æ’é™¤
global-exclude *.pyc
global-exclude __pycache__
global-exclude .DS_Store
global-exclude *.so
global-exclude *.pyd
```

### æ„å»ºå‰æ£€æŸ¥
```bash
# æ£€æŸ¥åŒ…ç»“æ„
check-manifest

# æ£€æŸ¥å…ƒæ•°æ®
python -m build --sdist
twine check dist/*

# éªŒè¯wheelå†…å®¹
python -m zipfile -l dist/my_package-1.0.0-py3-none-any.whl

# æµ‹è¯•å®‰è£…
pip install dist/my_package-1.0.0-py3-none-any.whl
```

## ğŸš€ åˆ†å‘å‡†å¤‡

### ç‰ˆæœ¬ç®¡ç†
```python
# è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶
version_strategy = {
    "å¼€å‘ç‰ˆæœ¬": "1.0.0.dev0",
    "é¢„å‘å¸ƒç‰ˆæœ¬": "1.0.0a1, 1.0.0b1, 1.0.0rc1",
    "æ­£å¼ç‰ˆæœ¬": "1.0.0",
    "ä¿®è¡¥ç‰ˆæœ¬": "1.0.1",
    "åŠŸèƒ½ç‰ˆæœ¬": "1.1.0",
    "é‡å¤§ç‰ˆæœ¬": "2.0.0"
}

# ä½¿ç”¨setuptools_scmè‡ªåŠ¨ç‰ˆæœ¬
# pyproject.toml
[tool.setuptools_scm]
write_to = "src/my_package/_version.py"
version_scheme = "post-release"
local_scheme = "dirty-tag"
```

### ä¾èµ–ç®¡ç†
```toml
# åˆç†çš„ä¾èµ–çº¦æŸ
[project]
dependencies = [
    "requests>=2.25.0,<3.0.0",  # å…¼å®¹èŒƒå›´
    "click>=7.0",               # æœ€å°ç‰ˆæœ¬
    "pydantic>=1.8.0,<2.0.0",  # ä¸»ç‰ˆæœ¬çº¦æŸ
]

# å¯é€‰ä¾èµ–
[project.optional-dependencies]
dev = [
    "pytest>=6.0",
    "black>=22.0",
    "flake8>=4.0",
    "mypy>=0.950",
]
docs = [
    "sphinx>=4.0",
    "sphinx-rtd-theme>=1.0",
]
all = [
    "my-package[dev,docs]",
]
```

### å…ƒæ•°æ®å®Œå–„
```toml
[project]
name = "my-awesome-package"
version = "1.0.0"
description = "A comprehensive Python package for awesome things"
readme = "README.md"
license = {file = "LICENSE"}
authors = [
    {name = "Your Name", email = "your.email@example.com"},
]
maintainers = [
    {name = "Team Lead", email = "lead@example.com"},
]
keywords = ["awesome", "python", "package"]
classifiers = [
    "Development Status :: 5 - Production/Stable",
    "Intended Audience :: Developers",
    "License :: OSI Approved :: MIT License",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.8",
    "Programming Language :: Python :: 3.9",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
    "Topic :: Software Development :: Libraries :: Python Modules",
]
requires-python = ">=3.8"

[project.urls]
Homepage = "https://github.com/yourusername/my-awesome-package"
Documentation = "https://my-awesome-package.readthedocs.io/"
Repository = "https://github.com/yourusername/my-awesome-package.git"
"Bug Tracker" = "https://github.com/yourusername/my-awesome-package/issues"
Changelog = "https://github.com/yourusername/my-awesome-package/blob/main/CHANGELOG.md"
```

## ğŸ” è´¨é‡æ£€æŸ¥

### è‡ªåŠ¨åŒ–æ£€æŸ¥è„šæœ¬
```bash
#!/bin/bash
# build_check.sh - æ„å»ºå‰è´¨é‡æ£€æŸ¥

set -e

echo "ğŸ” æ£€æŸ¥ä»£ç æ ¼å¼..."
black --check src/ tests/

echo "ğŸ” æ£€æŸ¥å¯¼å…¥æ’åº..."
isort --check-only src/ tests/

echo "ğŸ” æ£€æŸ¥ä»£ç è´¨é‡..."
flake8 src/ tests/

echo "ğŸ” ç±»å‹æ£€æŸ¥..."
mypy src/

echo "ğŸ” è¿è¡Œæµ‹è¯•..."
pytest tests/ --cov=src/

echo "ğŸ” æ£€æŸ¥åŒ…æ¸…å•..."
check-manifest

echo "ğŸ” æ„å»ºåŒ…..."
python -m build

echo "ğŸ” æ£€æŸ¥æ„å»ºäº§ç‰©..."
twine check dist/*

echo "âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼"
```

### æµ‹è¯•å®‰è£…
```bash
# åˆ›å»ºæµ‹è¯•ç¯å¢ƒ
python -m venv test_install
source test_install/bin/activate

# ä»wheelå®‰è£…
pip install dist/my_package-1.0.0-py3-none-any.whl

# æµ‹è¯•å¯¼å…¥
python -c "import my_package; print(my_package.__version__)"

# æµ‹è¯•å‘½ä»¤è¡Œå·¥å…·
my-tool --help

# æ¸…ç†
deactivate
rm -rf test_install
```

## ğŸ“Š æ„å»ºä¼˜åŒ–

### æ„å»ºæ€§èƒ½ä¼˜åŒ–
```python
optimization_tips = {
    "å¹¶è¡Œæ„å»º": "ä½¿ç”¨å¤šæ ¸CPUåŠ é€Ÿç¼–è¯‘",
    "ç¼“å­˜åˆ©ç”¨": "åˆ©ç”¨æ„å»ºç¼“å­˜å‡å°‘é‡å¤å·¥ä½œ",
    "ä¾èµ–é¢„ç¼–è¯‘": "ä½¿ç”¨é¢„ç¼–è¯‘çš„ä¾èµ–åŒ…",
    "å¢é‡æ„å»º": "åªæ„å»ºå˜æ›´çš„éƒ¨åˆ†",
    "æ„å»ºç¯å¢ƒ": "ä½¿ç”¨ä¸“é—¨çš„æ„å»ºç¯å¢ƒ"
}
```

### wheelæ ‡ç­¾ä¼˜åŒ–
```python
# wheelæ–‡ä»¶å‘½åè§£æ
# package-version-python_tag-abi_tag-platform_tag.whl

wheel_tags = {
    "python_tag": {
        "py3": "Python 3.xé€šç”¨",
        "py38": "Python 3.8ä¸“ç”¨",
        "cp38": "CPython 3.8ä¸“ç”¨"
    },
    "abi_tag": {
        "none": "çº¯Pythonï¼Œæ— ABIä¾èµ–",
        "cp38m": "CPython 3.8 with pymalloc",
        "abi3": "ç¨³å®šABI"
    },
    "platform_tag": {
        "any": "å¹³å°æ— å…³",
        "win_amd64": "Windows 64ä½",
        "macosx_10_9_x86_64": "macOS x86_64",
        "linux_x86_64": "Linux x86_64"
    }
}
```

## ğŸ¯ æœ¬èŠ‚å°ç»“

- **ç°ä»£æ„å»º**ï¼šä½¿ç”¨buildå·¥å…·è¿›è¡Œæ ‡å‡†åŒ–æ„å»º
- **æ„å»ºé…ç½®**ï¼šåœ¨pyproject.tomlä¸­é…ç½®æ„å»ºå‚æ•°
- **è´¨é‡æ£€æŸ¥**ï¼šæ„å»ºå‰è¿›è¡Œå…¨é¢çš„è´¨é‡æ£€æŸ¥
- **åˆ†å‘å‡†å¤‡**ï¼šå®Œå–„å…ƒæ•°æ®å’Œä¾èµ–ç®¡ç†
- **ä¼˜åŒ–ç­–ç•¥**ï¼šæé«˜æ„å»ºæ•ˆç‡å’ŒåŒ…è´¨é‡

## ğŸ’¡ å…³é”®è¦ç‚¹

1. **å·¥å…·é€‰æ‹©**ï¼šä½¿ç”¨ç°ä»£æ„å»ºå·¥å…·å¦‚build
2. **æ ‡å‡†éµå¾ª**ï¼šéµå¾ªPEP 517/518æ„å»ºæ ‡å‡†
3. **è´¨é‡ä¿è¯**ï¼šæ„å»ºå‰è¿›è¡Œå…¨é¢æ£€æŸ¥
4. **å…ƒæ•°æ®å®Œæ•´**ï¼šæä¾›å®Œæ•´å‡†ç¡®çš„åŒ…ä¿¡æ¯
5. **æµ‹è¯•éªŒè¯**ï¼šæ„å»ºåæµ‹è¯•å®‰è£…å’ŒåŠŸèƒ½

## ğŸ“š å»¶ä¼¸é˜…è¯»
- [PEP 517 - æ„å»ºç³»ç»Ÿæ¥å£](https://peps.python.org/pep-0517/)
- [PEP 518 - æ„å»ºç³»ç»Ÿè¦æ±‚](https://peps.python.org/pep-0518/)
- [buildå·¥å…·æ–‡æ¡£](https://build.pypa.io/)
- [wheelæ ¼å¼è§„èŒƒ](https://peps.python.org/pep-0427/)

---
**ä¸‹ä¸€èŠ‚é¢„å‘Š**ï¼š07-å‘å¸ƒåˆ°PyPI - å­¦ä¹ å¦‚ä½•å°†åŒ…å‘å¸ƒåˆ°PythonåŒ…ç´¢å¼•
