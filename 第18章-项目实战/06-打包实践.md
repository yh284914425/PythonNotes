# 06-æ‰“åŒ…å®è·µ

## ğŸ“¦ é¡¹ç›®æ‰“åŒ…æ¦‚è¿°

åœ¨å‰é¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†TaskMasteré¡¹ç›®çš„æ ¸å¿ƒåŠŸèƒ½å¼€å‘ã€æµ‹è¯•å’Œæ–‡æ¡£ç¼–å†™ã€‚ç°åœ¨æ˜¯æ—¶å€™å°†é¡¹ç›®æ‰“åŒ…æˆå¯åˆ†å‘çš„PythonåŒ…äº†ã€‚

### æ‰“åŒ…çš„ç›®æ ‡
```python
packaging_goals = {
    "ç”¨æˆ·å®‰è£…": "ç”¨æˆ·å¯ä»¥é€šè¿‡pip install taskmasterå®‰è£…",
    "å‘½ä»¤è¡Œå·¥å…·": "å®‰è£…åå¯ä»¥ç›´æ¥ä½¿ç”¨taskmasterå‘½ä»¤",
    "ä¾èµ–ç®¡ç†": "è‡ªåŠ¨å®‰è£…å’Œç®¡ç†é¡¹ç›®ä¾èµ–",
    "è·¨å¹³å°": "æ”¯æŒWindowsã€macOSã€Linux",
    "ç‰ˆæœ¬ç®¡ç†": "æ”¯æŒå¤šç‰ˆæœ¬å¹¶å­˜å’Œå‡çº§"
}
```

## ğŸ—ï¸ é¡¹ç›®ç»“æ„æ•´ç†

### æ ‡å‡†åŒ–é¡¹ç›®ç»“æ„
é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç¡®ä¿é¡¹ç›®ç»“æ„ç¬¦åˆPythonåŒ…çš„æ ‡å‡†ï¼š

```
taskmaster/
â”œâ”€â”€ pyproject.toml          # é¡¹ç›®é…ç½®æ–‡ä»¶
â”œâ”€â”€ README.md              # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ LICENSE               # è®¸å¯è¯æ–‡ä»¶
â”œâ”€â”€ CHANGELOG.md          # æ›´æ–°æ—¥å¿—
â”œâ”€â”€ MANIFEST.in           # åŒ…å«æ–‡ä»¶æ¸…å•
â”œâ”€â”€ .gitignore           # Gitå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ src/                  # æºç ç›®å½•
â”‚   â””â”€â”€ taskmaster/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ cli.py        # å‘½ä»¤è¡Œæ¥å£
â”‚       â”œâ”€â”€ models.py     # æ•°æ®æ¨¡å‹
â”‚       â”œâ”€â”€ storage.py    # æ•°æ®å­˜å‚¨
â”‚       â”œâ”€â”€ utils.py      # å·¥å…·å‡½æ•°
â”‚       â””â”€â”€ py.typed      # ç±»å‹æç¤ºæ ‡è®°
â”œâ”€â”€ tests/                # æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ conftest.py
â”‚   â”œâ”€â”€ test_models.py
â”‚   â”œâ”€â”€ test_storage.py
â”‚   â”œâ”€â”€ test_cli.py
â”‚   â””â”€â”€ test_utils.py
â”œâ”€â”€ docs/                 # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ conf.py
â”‚   â”œâ”€â”€ index.rst
â”‚   â””â”€â”€ api.rst
â””â”€â”€ examples/             # ç¤ºä¾‹ä»£ç 
    â””â”€â”€ basic_usage.py
```

### åˆ›å»ºå¿…è¦æ–‡ä»¶

#### 1. åˆ›å»ºpy.typedæ–‡ä»¶
```bash
# æ ‡è®°åŒ…æ”¯æŒç±»å‹æç¤º
touch src/taskmaster/py.typed
```

#### 2. æ›´æ–°__init__.py
```python
# src/taskmaster/__init__.py
"""
TaskMaster - ä¸€ä¸ªç®€å•è€Œå¼ºå¤§çš„ä»»åŠ¡ç®¡ç†å·¥å…·

TaskMasteræ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œä»»åŠ¡ç®¡ç†å·¥å…·ï¼Œå¸®åŠ©ä½ é«˜æ•ˆåœ°ç®¡ç†ä¸ªäººä»»åŠ¡å’Œå¾…åŠäº‹é¡¹ã€‚
"""

__version__ = "1.0.0"
__author__ = "Your Name"
__email__ = "your.email@example.com"

from .models import Task, TaskStatus, Priority
from .storage import TaskStorage
from .cli import main

__all__ = [
    "Task",
    "TaskStatus", 
    "Priority",
    "TaskStorage",
    "main",
    "__version__",
]
```

## âš™ï¸ é…ç½®pyproject.toml

### å®Œæ•´çš„é¡¹ç›®é…ç½®
```toml
# pyproject.toml
[build-system]
requires = ["setuptools>=61.0", "wheel"]
build-backend = "setuptools.build_meta"

[project]
name = "taskmaster"
version = "1.0.0"
description = "ä¸€ä¸ªç®€å•è€Œå¼ºå¤§çš„å‘½ä»¤è¡Œä»»åŠ¡ç®¡ç†å·¥å…·"
readme = "README.md"
license = {file = "LICENSE"}
authors = [
    {name = "Your Name", email = "your.email@example.com"},
]
maintainers = [
    {name = "Your Name", email = "your.email@example.com"},
]
keywords = ["task", "todo", "cli", "productivity", "management"]
classifiers = [
    "Development Status :: 5 - Production/Stable",
    "Environment :: Console",
    "Intended Audience :: End Users/Desktop",
    "Intended Audience :: Developers",
    "License :: OSI Approved :: MIT License",
    "Operating System :: OS Independent",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.8",
    "Programming Language :: Python :: 3.9",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
    "Topic :: Office/Business :: Scheduling",
    "Topic :: Utilities",
    "Typing :: Typed",
]
requires-python = ">=3.8"
dependencies = [
    "click>=8.0.0",
    "pydantic>=1.8.0",
    "rich>=12.0.0",
]

[project.optional-dependencies]
dev = [
    "pytest>=7.0.0",
    "pytest-cov>=3.0.0",
    "pytest-mock>=3.7.0",
    "black>=22.0.0",
    "flake8>=4.0.0",
    "isort>=5.10.0",
    "mypy>=0.950",
]
docs = [
    "sphinx>=4.5.0",
    "sphinx-rtd-theme>=1.0.0",
    "sphinx-click>=4.0.0",
]
test = [
    "pytest>=7.0.0",
    "pytest-cov>=3.0.0",
    "pytest-mock>=3.7.0",
]

[project.urls]
Homepage = "https://github.com/yourusername/taskmaster"
Documentation = "https://taskmaster.readthedocs.io/"
Repository = "https://github.com/yourusername/taskmaster.git"
"Bug Tracker" = "https://github.com/yourusername/taskmaster/issues"
Changelog = "https://github.com/yourusername/taskmaster/blob/main/CHANGELOG.md"

[project.scripts]
taskmaster = "taskmaster.cli:main"
tm = "taskmaster.cli:main"

[tool.setuptools]
package-dir = {"" = "src"}

[tool.setuptools.packages.find]
where = ["src"]
include = ["taskmaster*"]

[tool.setuptools.package-data]
taskmaster = ["py.typed"]

# å¼€å‘å·¥å…·é…ç½®
[tool.black]
line-length = 88
target-version = ['py38']
include = '\.pyi?$'
extend-exclude = '''
/(
  \.eggs
  | \.git
  | \.hg
  | \.mypy_cache
  | \.tox
  | \.venv
  | build
  | dist
)/
'''

[tool.isort]
profile = "black"
multi_line_output = 3
line_length = 88
known_first_party = ["taskmaster"]

[tool.mypy]
python_version = "3.8"
warn_return_any = true
warn_unused_configs = true
disallow_untyped_defs = true
mypy_path = "src"

[[tool.mypy.overrides]]
module = "tests.*"
disallow_untyped_defs = false

[tool.pytest.ini_options]
minversion = "7.0"
addopts = "-ra -q --strict-markers --strict-config"
testpaths = ["tests"]
python_files = ["test_*.py", "*_test.py"]
python_classes = ["Test*"]
python_functions = ["test_*"]
markers = [
    "slow: marks tests as slow (deselect with '-m \"not slow\"')",
    "integration: marks tests as integration tests",
]

[tool.coverage.run]
source = ["src"]
omit = ["*/tests/*", "*/test_*.py"]

[tool.coverage.report]
exclude_lines = [
    "pragma: no cover",
    "def __repr__",
    "raise AssertionError",
    "raise NotImplementedError",
    "if __name__ == .__main__.:",
]
```

## ğŸ“‹ åˆ›å»ºMANIFEST.in

### åŒ…å«æ–‡ä»¶æ¸…å•
```
# MANIFEST.in - æ§åˆ¶æºç åŒ…åŒ…å«çš„æ–‡ä»¶

# åŒ…å«é‡è¦æ–‡ä»¶
include README.md
include LICENSE
include CHANGELOG.md
include pyproject.toml

# åŒ…å«æ•°æ®æ–‡ä»¶
recursive-include src/taskmaster *.py
include src/taskmaster/py.typed

# åŒ…å«æ–‡æ¡£
recursive-include docs *.rst *.md *.py
recursive-include docs/_static *
recursive-include docs/_templates *

# åŒ…å«ç¤ºä¾‹
recursive-include examples *.py

# åŒ…å«æµ‹è¯•æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
recursive-include tests *.py

# æ’é™¤ä¸éœ€è¦çš„æ–‡ä»¶
exclude .gitignore
exclude .pre-commit-config.yaml
exclude tox.ini
exclude Makefile
exclude *.cfg

# æ’é™¤ç›®å½•
prune .git
prune .github
prune .pytest_cache
prune .mypy_cache
prune build
prune dist
prune *.egg-info

# å…¨å±€æ’é™¤
global-exclude *.pyc
global-exclude __pycache__
global-exclude .DS_Store
global-exclude *.so
global-exclude *.pyd
```

## ğŸ”§ å‘½ä»¤è¡Œå…¥å£é…ç½®

### CLIæ¨¡å—ä¼˜åŒ–
```python
# src/taskmaster/cli.py
"""
TaskMasterå‘½ä»¤è¡Œæ¥å£

æä¾›å®Œæ•´çš„å‘½ä»¤è¡ŒåŠŸèƒ½ï¼ŒåŒ…æ‹¬ä»»åŠ¡çš„å¢åˆ æ”¹æŸ¥ã€çŠ¶æ€ç®¡ç†ç­‰ã€‚
"""

import click
from typing import Optional
from .models import Task, TaskStatus, Priority
from .storage import TaskStorage
from . import __version__

# åˆ›å»ºå…¨å±€å­˜å‚¨å®ä¾‹
storage = TaskStorage()

@click.group()
@click.version_option(version=__version__, prog_name="taskmaster")
@click.pass_context
def main(ctx):
    """TaskMaster - ç®€å•è€Œå¼ºå¤§çš„ä»»åŠ¡ç®¡ç†å·¥å…·"""
    ctx.ensure_object(dict)
    ctx.obj['storage'] = storage

@main.command()
@click.argument('title')
@click.option('--description', '-d', help='ä»»åŠ¡æè¿°')
@click.option('--priority', '-p', 
              type=click.Choice(['low', 'medium', 'high']), 
              default='medium', help='ä»»åŠ¡ä¼˜å…ˆçº§')
@click.option('--tags', '-t', help='ä»»åŠ¡æ ‡ç­¾ï¼Œç”¨é€—å·åˆ†éš”')
@click.pass_context
def add(ctx, title: str, description: Optional[str], 
        priority: str, tags: Optional[str]):
    """æ·»åŠ æ–°ä»»åŠ¡"""
    task_tags = [tag.strip() for tag in tags.split(',')] if tags else []
    
    task = Task(
        title=title,
        description=description or "",
        priority=Priority(priority),
        tags=task_tags
    )
    
    task_id = ctx.obj['storage'].add_task(task)
    click.echo(f"âœ… ä»»åŠ¡å·²æ·»åŠ ï¼ŒID: {task_id}")

@main.command()
@click.option('--status', '-s', 
              type=click.Choice(['todo', 'doing', 'done']),
              help='æŒ‰çŠ¶æ€è¿‡æ»¤')
@click.option('--priority', '-p',
              type=click.Choice(['low', 'medium', 'high']),
              help='æŒ‰ä¼˜å…ˆçº§è¿‡æ»¤')
@click.option('--tag', '-t', help='æŒ‰æ ‡ç­¾è¿‡æ»¤')
@click.pass_context
def list(ctx, status: Optional[str], priority: Optional[str], 
         tag: Optional[str]):
    """åˆ—å‡ºä»»åŠ¡"""
    tasks = ctx.obj['storage'].get_tasks()
    
    # åº”ç”¨è¿‡æ»¤å™¨
    if status:
        tasks = [t for t in tasks if t.status.value == status]
    if priority:
        tasks = [t for t in tasks if t.priority.value == priority]
    if tag:
        tasks = [t for t in tasks if tag in t.tags]
    
    if not tasks:
        click.echo("ğŸ“ æ²¡æœ‰æ‰¾åˆ°ä»»åŠ¡")
        return
    
    for task in tasks:
        status_icon = {"todo": "â³", "doing": "ğŸ”„", "done": "âœ…"}
        priority_icon = {"low": "ğŸ”µ", "medium": "ğŸŸ¡", "high": "ğŸ”´"}
        
        click.echo(f"{status_icon[task.status.value]} "
                  f"{priority_icon[task.priority.value]} "
                  f"[{task.id}] {task.title}")
        
        if task.description:
            click.echo(f"    ğŸ“„ {task.description}")
        
        if task.tags:
            click.echo(f"    ğŸ·ï¸  {', '.join(task.tags)}")

if __name__ == "__main__":
    main()
```

## ğŸ§ª æ„å»ºå‰æµ‹è¯•

### åˆ›å»ºæ„å»ºæµ‹è¯•è„šæœ¬
```bash
#!/bin/bash
# scripts/build_test.sh - æ„å»ºå‰æµ‹è¯•è„šæœ¬

set -e

echo "ğŸ” å¼€å§‹æ„å»ºå‰æµ‹è¯•..."

# 1. ä»£ç è´¨é‡æ£€æŸ¥
echo "ğŸ“ ä»£ç æ ¼å¼æ£€æŸ¥..."
black --check src/ tests/

echo "ğŸ“ å¯¼å…¥æ’åºæ£€æŸ¥..."
isort --check-only src/ tests/

echo "ğŸ“ ä»£ç è´¨é‡æ£€æŸ¥..."
flake8 src/ tests/

echo "ğŸ“ ç±»å‹æ£€æŸ¥..."
mypy src/

# 2. è¿è¡Œæµ‹è¯•
echo "ğŸ§ª è¿è¡Œæµ‹è¯•å¥—ä»¶..."
pytest tests/ --cov=src/ --cov-report=term-missing

# 3. æ£€æŸ¥åŒ…æ¸…å•
echo "ğŸ“‹ æ£€æŸ¥åŒ…æ¸…å•..."
check-manifest

# 4. æ„å»ºåŒ…
echo "ğŸ—ï¸ æ„å»ºåŒ…..."
python -m build

# 5. æ£€æŸ¥æ„å»ºäº§ç‰©
echo "ğŸ” æ£€æŸ¥æ„å»ºäº§ç‰©..."
twine check dist/*

echo "âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼"
```

### è¿è¡Œæ„å»ºæµ‹è¯•
```bash
# ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x scripts/build_test.sh

# è¿è¡Œæµ‹è¯•
./scripts/build_test.sh
```

## ğŸ“¦ å®é™…æ„å»ºè¿‡ç¨‹

### 1. æ¸…ç†æ—§æ„å»º
```bash
# æ¸…ç†æ—§çš„æ„å»ºæ–‡ä»¶
rm -rf build/ dist/ *.egg-info/
```

### 2. æ„å»ºåŒ…
```bash
# ä½¿ç”¨buildå·¥å…·æ„å»º
python -m build

# æŸ¥çœ‹æ„å»ºç»“æœ
ls -la dist/
# taskmaster-1.0.0-py3-none-any.whl
# taskmaster-1.0.0.tar.gz
```

### 3. æ£€æŸ¥æ„å»ºäº§ç‰©
```bash
# æ£€æŸ¥wheelå†…å®¹
python -m zipfile -l dist/taskmaster-1.0.0-py3-none-any.whl

# æ£€æŸ¥åŒ…å…ƒæ•°æ®
twine check dist/*
```

## ğŸ§ª æœ¬åœ°å®‰è£…æµ‹è¯•

### åˆ›å»ºæµ‹è¯•ç¯å¢ƒ
```bash
# åˆ›å»ºæ–°çš„è™šæ‹Ÿç¯å¢ƒè¿›è¡Œæµ‹è¯•
python -m venv test_env
source test_env/bin/activate  # Linux/Mac
# æˆ– test_env\Scripts\activate  # Windows

# ä»wheelå®‰è£…
pip install dist/taskmaster-1.0.0-py3-none-any.whl

# æµ‹è¯•å‘½ä»¤è¡Œå·¥å…·
taskmaster --version
taskmaster --help

# æµ‹è¯•åŸºæœ¬åŠŸèƒ½
taskmaster add "æµ‹è¯•ä»»åŠ¡" --description "è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ä»»åŠ¡"
taskmaster list

# æµ‹è¯•Pythonå¯¼å…¥
python -c "import taskmaster; print(taskmaster.__version__)"

# æ¸…ç†æµ‹è¯•ç¯å¢ƒ
deactivate
rm -rf test_env
```

### åŠŸèƒ½æµ‹è¯•è„šæœ¬
```python
#!/usr/bin/env python3
# scripts/test_installation.py - å®‰è£…æµ‹è¯•è„šæœ¬

import subprocess
import sys
import tempfile
import os

def run_command(cmd, description):
    """è¿è¡Œå‘½ä»¤å¹¶æ£€æŸ¥ç»“æœ"""
    print(f"ğŸ” {description}...")
    try:
        result = subprocess.run(cmd, shell=True, check=True, 
                              capture_output=True, text=True)
        print(f"âœ… {description} - æˆåŠŸ")
        return True
    except subprocess.CalledProcessError as e:
        print(f"âŒ {description} - å¤±è´¥")
        print(f"é”™è¯¯: {e.stderr}")
        return False

def main():
    """æµ‹è¯•å®‰è£…çš„åŒ…"""
    with tempfile.TemporaryDirectory() as temp_dir:
        os.chdir(temp_dir)
        
        tests = [
            ("taskmaster --version", "ç‰ˆæœ¬æ£€æŸ¥"),
            ("taskmaster --help", "å¸®åŠ©ä¿¡æ¯"),
            ("taskmaster add 'æµ‹è¯•ä»»åŠ¡' -d 'æµ‹è¯•æè¿°'", "æ·»åŠ ä»»åŠ¡"),
            ("taskmaster list", "åˆ—å‡ºä»»åŠ¡"),
            ("python -c 'import taskmaster; print(taskmaster.__version__)'", "Pythonå¯¼å…¥"),
        ]
        
        failed_tests = []
        
        for cmd, desc in tests:
            if not run_command(cmd, desc):
                failed_tests.append(desc)
        
        if failed_tests:
            print(f"\nâŒ {len(failed_tests)} é¡¹æµ‹è¯•å¤±è´¥:")
            for test in failed_tests:
                print(f"  - {test}")
            sys.exit(1)
        else:
            print(f"\nâœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼")

if __name__ == "__main__":
    main()
```

## ğŸ¯ æœ¬èŠ‚å°ç»“

é€šè¿‡æœ¬èŠ‚çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å®Œæˆäº†ï¼š

### âœ… å®Œæˆçš„å·¥ä½œ
- **é¡¹ç›®ç»“æ„æ ‡å‡†åŒ–**ï¼šæŒ‰ç…§PythonåŒ…æ ‡å‡†ç»„ç»‡é¡¹ç›®ç»“æ„
- **é…ç½®æ–‡ä»¶å®Œå–„**ï¼šåˆ›å»ºå®Œæ•´çš„pyproject.tomlé…ç½®
- **å‘½ä»¤è¡Œå·¥å…·é…ç½®**ï¼šè®¾ç½®CLIå…¥å£ç‚¹å’Œå‘½ä»¤
- **æ„å»ºæµ‹è¯•**ï¼šéªŒè¯åŒ…çš„æ„å»ºå’Œå®‰è£…
- **è´¨é‡æ£€æŸ¥**ï¼šç¡®ä¿ä»£ç è´¨é‡å’ŒåŒ…å®Œæ•´æ€§

### ğŸ“¦ æ„å»ºäº§ç‰©
- **æºç åŒ…**ï¼štaskmaster-1.0.0.tar.gz
- **äºŒè¿›åˆ¶åŒ…**ï¼štaskmaster-1.0.0-py3-none-any.whl
- **å‘½ä»¤è¡Œå·¥å…·**ï¼šå¯ä»¥é€šè¿‡taskmasterå‘½ä»¤ä½¿ç”¨
- **PythonåŒ…**ï¼šå¯ä»¥é€šè¿‡import taskmasterå¯¼å…¥

### ğŸ”§ å…³é”®é…ç½®
- **å…¥å£ç‚¹**ï¼šé…ç½®äº†taskmasterå’Œtmä¸¤ä¸ªå‘½ä»¤
- **ä¾èµ–ç®¡ç†**ï¼šæ˜ç¡®å£°æ˜äº†è¿è¡Œæ—¶å’Œå¼€å‘æ—¶ä¾èµ–
- **ç±»å‹æ”¯æŒ**ï¼šåŒ…å«py.typedæ–‡ä»¶æ”¯æŒç±»å‹æ£€æŸ¥
- **å…ƒæ•°æ®å®Œæ•´**ï¼šæä¾›äº†å®Œæ•´çš„åŒ…å…ƒæ•°æ®ä¿¡æ¯

## ğŸ’¡ å…³é”®è¦ç‚¹

1. **ç»“æ„æ ‡å‡†**ï¼šéµå¾ªPythonåŒ…çš„æ ‡å‡†ç›®å½•ç»“æ„
2. **é…ç½®å®Œæ•´**ï¼špyproject.tomlåŒ…å«æ‰€æœ‰å¿…è¦é…ç½®
3. **æµ‹è¯•éªŒè¯**ï¼šæ„å»ºå‰åéƒ½è¦è¿›è¡Œå……åˆ†æµ‹è¯•
4. **å‘½ä»¤è¡Œå·¥å…·**ï¼šæ­£ç¡®é…ç½®CLIå…¥å£ç‚¹
5. **è´¨é‡ä¿è¯**ï¼šä½¿ç”¨å·¥å…·ç¡®ä¿ä»£ç å’ŒåŒ…è´¨é‡

## ğŸ“š å»¶ä¼¸å­¦ä¹ 
- å­¦ä¹ æ›´å¤šsetuptoolsé…ç½®é€‰é¡¹
- äº†è§£ä¸åŒæ„å»ºåç«¯çš„ç‰¹ç‚¹
- ç ”ç©¶å¤æ‚é¡¹ç›®çš„æ‰“åŒ…ç­–ç•¥
- å­¦ä¹ Cæ‰©å±•çš„æ‰“åŒ…æ–¹æ³•

---
**ä¸‹ä¸€èŠ‚é¢„å‘Š**ï¼š07-å‘å¸ƒæµç¨‹ - å­¦ä¹ å¦‚ä½•å°†æˆ‘ä»¬çš„TaskMasteråŒ…å‘å¸ƒåˆ°PyPI
