# 04-åŒ…çš„æ¦‚å¿µ

## ğŸ“¦ ä»€ä¹ˆæ˜¯åŒ…ï¼Ÿ

### åŒ…çš„å®šä¹‰
åŒ…ï¼ˆPackageï¼‰æ˜¯åŒ…å«å¤šä¸ªæ¨¡å—çš„ç›®å½•ï¼Œç”¨äºç»„ç»‡ç›¸å…³çš„æ¨¡å—ã€‚åŒ…å¿…é¡»åŒ…å«ä¸€ä¸ª`__init__.py`æ–‡ä»¶ï¼ˆå¯ä»¥ä¸ºç©ºï¼‰ï¼Œè¿™ä¸ªæ–‡ä»¶å‘Šè¯‰Pythonè¿™ä¸ªç›®å½•æ˜¯ä¸€ä¸ªåŒ…ã€‚

### åŒ…çš„ä½œç”¨
- **æ¨¡å—ç»„ç»‡**ï¼šå°†ç›¸å…³æ¨¡å—ç»„ç»‡åœ¨ä¸€èµ·
- **å‘½åç©ºé—´**ï¼šé¿å…æ¨¡å—åå†²çª
- **ä»£ç åˆ†å±‚**ï¼šæ”¯æŒå±‚æ¬¡åŒ–çš„ä»£ç ç»“æ„
- **å›¢é˜Ÿåä½œ**ï¼šä¾¿äºå¤§å‹é¡¹ç›®çš„æ¨¡å—ç®¡ç†

## ğŸ—ï¸ åŒ…çš„ç»“æ„

### åŸºæœ¬åŒ…ç»“æ„
```
my_package/
    __init__.py          # åŒ…çš„åˆå§‹åŒ–æ–‡ä»¶
    module1.py           # æ¨¡å—1
    module2.py           # æ¨¡å—2
    constants.py         # å¸¸é‡æ¨¡å—
```

### å¤æ‚åŒ…ç»“æ„
```
my_project/
    __init__.py
    core/
        __init__.py
        engine.py
        utils.py
    data/
        __init__.py
        models.py
        database.py
    ui/
        __init__.py
        widgets.py
        dialogs.py
    tests/
        __init__.py
        test_core.py
        test_data.py
```

## ğŸ“ åˆ›å»ºåŒ…çš„ç¤ºä¾‹

### 1. åˆ›å»ºå·¥å…·åŒ…
è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º`utils`çš„å·¥å…·åŒ…ï¼š

**ç›®å½•ç»“æ„ï¼š**
```
utils/
    __init__.py
    string_utils.py
    math_utils.py
    file_utils.py
```

**utils/__init__.py**
```python
"""
utils - å®ç”¨å·¥å…·åŒ…

æä¾›å­—ç¬¦ä¸²å¤„ç†ã€æ•°å­¦è®¡ç®—ã€æ–‡ä»¶æ“ä½œç­‰å·¥å…·å‡½æ•°
"""

__version__ = "1.0.0"
__author__ = "Pythonå­¦ä¹ è€…"

# å¯¼å…¥å­æ¨¡å—ï¼Œæ–¹ä¾¿ä½¿ç”¨
from .string_utils import reverse_string, count_words
from .math_utils import factorial, is_prime
from .file_utils import read_file, write_file

# å®šä¹‰åŒ…çš„å…¬å…±æ¥å£
__all__ = [
    'reverse_string',
    'count_words', 
    'factorial',
    'is_prime',
    'read_file',
    'write_file'
]

print(f"utilsåŒ… v{__version__} å·²åŠ è½½")
```

**utils/string_utils.py**
```python
"""å­—ç¬¦ä¸²å·¥å…·æ¨¡å—"""

def reverse_string(s):
    """åè½¬å­—ç¬¦ä¸²"""
    return s[::-1]

def count_words(s):
    """ç»Ÿè®¡å•è¯æ•°é‡"""
    return len(s.split())

def capitalize_words(s):
    """æ¯ä¸ªå•è¯é¦–å­—æ¯å¤§å†™"""
    return ' '.join(word.capitalize() for word in s.split())

def is_palindrome(s):
    """æ£€æŸ¥æ˜¯å¦ä¸ºå›æ–‡"""
    cleaned = s.lower().replace(' ', '')
    return cleaned == cleaned[::-1]
```

**utils/math_utils.py**
```python
"""æ•°å­¦å·¥å…·æ¨¡å—"""

def factorial(n):
    """è®¡ç®—é˜¶ä¹˜"""
    if n <= 1:
        return 1
    return n * factorial(n - 1)

def is_prime(n):
    """åˆ¤æ–­æ˜¯å¦ä¸ºè´¨æ•°"""
    if n < 2:
        return False
    for i in range(2, int(n ** 0.5) + 1):
        if n % i == 0:
            return False
    return True

def fibonacci(n):
    """ç”Ÿæˆæ–æ³¢é‚£å¥‘æ•°åˆ—"""
    if n <= 0:
        return []
    elif n == 1:
        return [0]
    elif n == 2:
        return [0, 1]
    
    fib = [0, 1]
    for i in range(2, n):
        fib.append(fib[i-1] + fib[i-2])
    return fib
```

**utils/file_utils.py**
```python
"""æ–‡ä»¶å·¥å…·æ¨¡å—"""

def read_file(filename):
    """è¯»å–æ–‡ä»¶å†…å®¹"""
    try:
        with open(filename, 'r', encoding='utf-8') as f:
            return f.read()
    except FileNotFoundError:
        return None

def write_file(filename, content):
    """å†™å…¥æ–‡ä»¶"""
    try:
        with open(filename, 'w', encoding='utf-8') as f:
            f.write(content)
        return True
    except Exception:
        return False

def file_exists(filename):
    """æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨"""
    import os
    return os.path.exists(filename)
```

### 2. ä½¿ç”¨åŒ…
```python
# æ–¹å¼1ï¼šå¯¼å…¥æ•´ä¸ªåŒ…
import utils
print(utils.reverse_string("hello"))  # olleh
print(utils.factorial(5))              # 120

# æ–¹å¼2ï¼šå¯¼å…¥ç‰¹å®šæ¨¡å—
from utils import string_utils
print(string_utils.count_words("hello world"))  # 2

# æ–¹å¼3ï¼šå¯¼å…¥ç‰¹å®šå‡½æ•°
from utils.math_utils import is_prime, fibonacci
print(is_prime(17))      # True
print(fibonacci(5))      # [0, 1, 1, 2, 3]

# æ–¹å¼4ï¼šä½¿ç”¨åˆ«å
import utils.file_utils as fu
content = fu.read_file('test.txt')
```

## ğŸ”„ ç›¸å¯¹å¯¼å…¥å’Œç»å¯¹å¯¼å…¥

### ç»å¯¹å¯¼å…¥
ä»åŒ…çš„æ ¹ç›®å½•å¼€å§‹çš„å®Œæ•´è·¯å¾„ï¼š

```python
# åœ¨ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨
from utils.string_utils import reverse_string
from utils.math_utils import factorial
from my_project.core.engine import Engine
```

### ç›¸å¯¹å¯¼å…¥
ç›¸å¯¹äºå½“å‰æ¨¡å—çš„ä½ç½®ï¼š

```python
# åªèƒ½åœ¨åŒ…å†…éƒ¨ä½¿ç”¨
# åœ¨utils/string_utils.pyä¸­ï¼š

# å¯¼å…¥åŒçº§æ¨¡å—
from . import math_utils
from .math_utils import factorial

# å¯¼å…¥ä¸Šçº§åŒ…çš„æ¨¡å—
from .. import config
from ..core import engine

# å¯¼å…¥å­åŒ…
from ..data.models import User
```

### ç›¸å¯¹å¯¼å…¥ç¤ºä¾‹
```
my_project/
    __init__.py
    config.py
    core/
        __init__.py
        engine.py      # æˆ‘ä»¬åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­
        utils.py
    data/
        __init__.py
        models.py
```

**åœ¨core/engine.pyä¸­ï¼š**
```python
# ç›¸å¯¹å¯¼å…¥ç¤ºä¾‹
from . import utils           # å¯¼å…¥åŒçº§çš„utils.py
from .utils import helper     # å¯¼å…¥åŒçº§æ¨¡å—çš„å‡½æ•°
from .. import config         # å¯¼å…¥ä¸Šçº§çš„config.py
from ..data import models     # å¯¼å…¥å…„å¼ŸåŒ…çš„models.py
from ..data.models import User # å¯¼å…¥å…„å¼ŸåŒ…æ¨¡å—çš„ç±»
```

## ğŸ›ï¸ __init__.py çš„é«˜çº§ç”¨æ³•

### 1. åŒ…åˆå§‹åŒ–
```python
# my_package/__init__.py
"""
my_package - æˆ‘çš„PythonåŒ…

è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹åŒ…ï¼Œå±•ç¤ºåŒ…çš„å„ç§åŠŸèƒ½
"""

import logging

# åŒ…çº§åˆ«çš„é…ç½®
__version__ = "2.1.0"
__author__ = "å¼€å‘å›¢é˜Ÿ"
__email__ = "team@example.com"

# è®¾ç½®æ—¥å¿—
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# åŒ…åˆå§‹åŒ–ä»£ç 
logger.info(f"åˆå§‹åŒ– {__name__} v{__version__}")

# å¯¼å…¥å­æ¨¡å—
from .core import Engine
from .utils import helper_function

# å®šä¹‰åŒ…çº§åˆ«çš„å‡½æ•°
def get_version():
    """è·å–åŒ…ç‰ˆæœ¬"""
    return __version__

def get_info():
    """è·å–åŒ…ä¿¡æ¯"""
    return {
        'name': __name__,
        'version': __version__,
        'author': __author__,
        'email': __email__
    }
```

### 2. æ§åˆ¶å¯¼å…¥è¡Œä¸º
```python
# __init__.py
"""æ§åˆ¶from package import *çš„è¡Œä¸º"""

# åªæœ‰__all__ä¸­çš„å†…å®¹ä¼šè¢«å¯¼å…¥
__all__ = [
    'Engine',
    'helper_function',
    'get_version',
    'CONSTANT_VALUE'
]

from .core import Engine
from .utils import helper_function

CONSTANT_VALUE = 42

# ç§æœ‰å†…å®¹ä¸ä¼šè¢«å¯¼å…¥
_private_function = lambda: None
```

### 3. æ‡’åŠ è½½
```python
# __init__.py
"""å®ç°æ‡’åŠ è½½ï¼Œæé«˜å¯¼å…¥æ€§èƒ½"""

def __getattr__(name):
    """åŠ¨æ€å¯¼å…¥æ¨¡å—"""
    if name == 'heavy_module':
        from . import heavy_module
        return heavy_module
    elif name == 'optional_module':
        try:
            from . import optional_module
            return optional_module
        except ImportError:
            raise AttributeError(f"æ¨¡å— {name} ä¸å¯ç”¨")
    
    raise AttributeError(f"æ¨¡å— {__name__} æ²¡æœ‰å±æ€§ {name}")
```

## ğŸŒ³ å­åŒ…å’ŒåµŒå¥—åŒ…

### æ·±å±‚åµŒå¥—ç»“æ„
```
company_project/
    __init__.py
    common/
        __init__.py
        utils.py
        constants.py
    backend/
        __init__.py
        api/
            __init__.py
            v1/
                __init__.py
                users.py
                products.py
            v2/
                __init__.py
                users.py
        database/
            __init__.py
            mysql.py
            postgresql.py
    frontend/
        __init__.py
        components/
            __init__.py
            widgets.py
        pages/
            __init__.py
            home.py
            login.py
```

### è·¨å­åŒ…å¯¼å…¥
```python
# åœ¨backend/api/v1/users.pyä¸­
from ....common.utils import validate_email  # 4çº§å‘ä¸Š
from ...database.mysql import connect        # 3çº§å‘ä¸Š
from ..v2.users import new_feature          # å…„å¼ŸåŒ…
```

## ğŸ“‹ åŒ…çš„æœ€ä½³å®è·µ

### 1. åŒ…å‘½åè§„èŒƒ
```python
# å¥½çš„åŒ…å
utils
data_processing
web_framework
machine_learning

# ä¸å¥½çš„åŒ…å
Utils           # ä¸è¦ç”¨å¤§å†™
data-processing # ä¸è¦ç”¨è¿å­—ç¬¦
web.framework   # ä¸è¦ç”¨ç‚¹å·
```

### 2. åŒ…ç»“æ„è®¾è®¡
```python
# æŒ‰åŠŸèƒ½ç»„ç»‡
my_project/
    core/          # æ ¸å¿ƒåŠŸèƒ½
    utils/         # å·¥å…·å‡½æ•°
    models/        # æ•°æ®æ¨¡å‹
    views/         # è§†å›¾å±‚
    tests/         # æµ‹è¯•ä»£ç 

# æŒ‰å±‚æ¬¡ç»„ç»‡
my_project/
    presentation/  # è¡¨ç¤ºå±‚
    business/      # ä¸šåŠ¡å±‚
    data/          # æ•°æ®å±‚
    common/        # å…¬å…±ç»„ä»¶
```

### 3. ç‰ˆæœ¬ç®¡ç†
```python
# version.py
__version_info__ = (1, 2, 3)
__version__ = '.'.join(map(str, __version_info__))

# __init__.py
from .version import __version__

def get_version():
    return __version__
```

### 4. ä¾èµ–ç®¡ç†
```python
# requirements.txt
requests>=2.25.0
numpy>=1.19.0
pandas>=1.2.0

# setup.pyä¸­çš„ä¾èµ–å£°æ˜
install_requires=[
    'requests>=2.25.0',
    'numpy>=1.19.0',
]
```

## ğŸ” åŒ…çš„å†…çœå’Œè°ƒè¯•

### æŸ¥çœ‹åŒ…ä¿¡æ¯
```python
import my_package

# æŸ¥çœ‹åŒ…çš„å±æ€§
print(dir(my_package))

# æŸ¥çœ‹åŒ…çš„è·¯å¾„
print(my_package.__path__)

# æŸ¥çœ‹åŒ…çš„æ–‡æ¡£
print(my_package.__doc__)

# æŸ¥çœ‹åŒ…çš„ç‰ˆæœ¬
print(getattr(my_package, '__version__', 'Unknown'))
```

### åŠ¨æ€å‘ç°å­æ¨¡å—
```python
import pkgutil
import my_package

# éå†åŒ…ä¸­çš„æ‰€æœ‰æ¨¡å—
for importer, modname, ispkg in pkgutil.iter_modules(my_package.__path__):
    print(f"å‘ç°{'åŒ…' if ispkg else 'æ¨¡å—'}: {modname}")
```

## ğŸ¯ æœ¬èŠ‚å°ç»“

- **åŒ…çš„æ¦‚å¿µ**ï¼šåŒ…å«__init__.pyçš„ç›®å½•ï¼Œç”¨äºç»„ç»‡å¤šä¸ªæ¨¡å—
- **åŒ…çš„ç»“æ„**ï¼šæ”¯æŒåµŒå¥—ç»“æ„ï¼Œå¯ä»¥åˆ›å»ºå¤æ‚çš„å±‚æ¬¡å…³ç³»
- **å¯¼å…¥æ–¹å¼**ï¼šç»å¯¹å¯¼å…¥å’Œç›¸å¯¹å¯¼å…¥ï¼Œå„æœ‰é€‚ç”¨åœºæ™¯
- **__init__.py**ï¼šæ§åˆ¶åŒ…çš„åˆå§‹åŒ–ã€å¯¼å…¥è¡Œä¸ºå’Œå…¬å…±æ¥å£
- **æœ€ä½³å®è·µ**ï¼šåˆç†å‘½åã€æŒ‰åŠŸèƒ½ç»„ç»‡ã€ç‰ˆæœ¬ç®¡ç†ã€ä¾èµ–ç®¡ç†

## ğŸ“š ä¸‹ä¸€æ­¥å­¦ä¹ 
å­¦ä¹ å®ŒåŒ…çš„æ¦‚å¿µåï¼Œæ¥ä¸‹æ¥å­¦ä¹  **[05-æ ‡å‡†åº“æ¨¡å—.md](./05-æ ‡å‡†åº“æ¨¡å—.md)**ï¼Œäº†è§£Pythonä¸°å¯Œçš„æ ‡å‡†åº“ã€‚
