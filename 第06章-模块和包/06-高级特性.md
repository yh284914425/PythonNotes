# 06-é«˜çº§ç‰¹æ€§

## ğŸ”§ æ¨¡å—çš„é«˜çº§å±æ€§å’Œå†…çœ

### 1. æ¨¡å—å±æ€§è¯¦è§£
```python
import math
import sys

# åŸºæœ¬æ¨¡å—å±æ€§
print(f"æ¨¡å—å: {math.__name__}")           # 'math'
print(f"æ¨¡å—æ–‡æ¡£: {math.__doc__[:50]}...")   # æ¨¡å—æ–‡æ¡£å­—ç¬¦ä¸²
print(f"æ¨¡å—æ–‡ä»¶: {getattr(math, '__file__', 'å†…ç½®æ¨¡å—')}")

# æŸ¥çœ‹æ¨¡å—çš„æ‰€æœ‰å±æ€§
attributes = dir(math)
print(f"mathæ¨¡å—å±æ€§æ•°é‡: {len(attributes)}")
print(f"éƒ¨åˆ†å±æ€§: {attributes[:10]}")

# æ£€æŸ¥å±æ€§ç±»å‹
for attr_name in ['pi', 'sqrt', 'sin']:
    attr = getattr(math, attr_name)
    print(f"{attr_name}: {type(attr).__name__}")
```

### 2. åŠ¨æ€å±æ€§è®¿é—®
```python
# åŠ¨æ€è·å–å±æ€§
module_name = 'math'
attr_name = 'pi'

# æ–¹æ³•1: getattr
module = __import__(module_name)
value = getattr(module, attr_name)
print(f"{module_name}.{attr_name} = {value}")

# æ–¹æ³•2: hasattræ£€æŸ¥
if hasattr(module, attr_name):
    print(f"æ¨¡å—{module_name}æœ‰å±æ€§{attr_name}")

# æ–¹æ³•3: åŠ¨æ€è°ƒç”¨å‡½æ•°
func_name = 'sqrt'
if hasattr(module, func_name):
    func = getattr(module, func_name)
    result = func(16)
    print(f"{func_name}(16) = {result}")
```

### 3. æ¨¡å—ç¼“å­˜æœºåˆ¶
```python
import sys

# æŸ¥çœ‹æ¨¡å—ç¼“å­˜
print("å·²ç¼“å­˜çš„æ¨¡å—:")
cached_modules = list(sys.modules.keys())
print(f"ç¼“å­˜æ¨¡å—æ•°é‡: {len(cached_modules)}")
print(f"éƒ¨åˆ†æ¨¡å—: {cached_modules[:5]}")

# æ£€æŸ¥ç‰¹å®šæ¨¡å—æ˜¯å¦å·²ç¼“å­˜
module_name = 'json'
if module_name in sys.modules:
    print(f"{module_name}æ¨¡å—å·²åœ¨ç¼“å­˜ä¸­")
    cached_module = sys.modules[module_name]
    print(f"ç¼“å­˜çš„æ¨¡å—å¯¹è±¡: {cached_module}")

# æ‰‹åŠ¨ä»ç¼“å­˜ä¸­ç§»é™¤æ¨¡å—ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
# del sys.modules['some_module']
```

## ğŸ”„ åŠ¨æ€å¯¼å…¥å’Œé‡è½½

### 1. importlibé«˜çº§ç”¨æ³•
```python
import importlib
import importlib.util

# åŠ¨æ€å¯¼å…¥æ¨¡å—
def dynamic_import(module_name):
    """åŠ¨æ€å¯¼å…¥æ¨¡å—"""
    try:
        module = importlib.import_module(module_name)
        print(f"æˆåŠŸå¯¼å…¥æ¨¡å—: {module_name}")
        return module
    except ImportError as e:
        print(f"å¯¼å…¥å¤±è´¥: {e}")
        return None

# æµ‹è¯•åŠ¨æ€å¯¼å…¥
json_module = dynamic_import('json')
if json_module:
    data = json_module.dumps({'key': 'value'})
    print(f"JSONæ•°æ®: {data}")

# ä»æ–‡ä»¶è·¯å¾„å¯¼å…¥æ¨¡å—
def import_from_path(module_name, file_path):
    """ä»æŒ‡å®šè·¯å¾„å¯¼å…¥æ¨¡å—"""
    spec = importlib.util.spec_from_file_location(module_name, file_path)
    if spec and spec.loader:
        module = importlib.util.module_from_spec(spec)
        spec.loader.exec_module(module)
        return module
    return None

# é‡æ–°åŠ è½½æ¨¡å—ï¼ˆå¼€å‘æ—¶æœ‰ç”¨ï¼‰
def reload_module(module):
    """é‡æ–°åŠ è½½æ¨¡å—"""
    try:
        importlib.reload(module)
        print(f"æ¨¡å—{module.__name__}é‡æ–°åŠ è½½æˆåŠŸ")
    except Exception as e:
        print(f"é‡æ–°åŠ è½½å¤±è´¥: {e}")
```

### 2. æ¡ä»¶å¯¼å…¥å’Œå…¼å®¹æ€§å¤„ç†
```python
# ç‰ˆæœ¬å…¼å®¹æ€§å¯¼å…¥
import sys

if sys.version_info >= (3, 8):
    from functools import cached_property
else:
    # ä¸ºæ—§ç‰ˆæœ¬æä¾›æ›¿ä»£å®ç°
    def cached_property(func):
        return property(func)

# å¯é€‰ä¾èµ–å¤„ç†
def get_available_features():
    """æ£€æŸ¥å¯ç”¨åŠŸèƒ½"""
    features = {}
    
    # æ£€æŸ¥NumPy
    try:
        import numpy
        features['numpy'] = numpy.__version__
    except ImportError:
        features['numpy'] = None
    
    # æ£€æŸ¥Pandas
    try:
        import pandas
        features['pandas'] = pandas.__version__
    except ImportError:
        features['pandas'] = None
    
    return features

# å¹³å°ç‰¹å®šå¯¼å…¥
import platform

if platform.system() == 'Windows':
    try:
        import winsound
        def beep():
            winsound.Beep(1000, 500)
    except ImportError:
        def beep():
            print("Beep!")
else:
    def beep():
        print("\a")  # ASCIIå“é“ƒå­—ç¬¦
```

## ğŸ“¦ åŒ…çš„é«˜çº§ç‰¹æ€§

### 1. å‘½åç©ºé—´åŒ…
```python
# å‘½åç©ºé—´åŒ…å…è®¸å°†åŒ…åˆ†å¸ƒåœ¨å¤šä¸ªç›®å½•ä¸­
# ä¸éœ€è¦__init__.pyæ–‡ä»¶

# ç›®å½•ç»“æ„:
# namespace_package/
#     part1/
#         module1.py
#     part2/
#         module2.py

# ä½¿ç”¨æ—¶:
# from namespace_package.part1 import module1
# from namespace_package.part2 import module2
```

### 2. åŒ…çš„å…ƒæ•°æ®ç®¡ç†
```python
# åœ¨__init__.pyä¸­å®šä¹‰åŒ…çš„å…ƒæ•°æ®
__version__ = "1.2.3"
__author__ = "å¼€å‘å›¢é˜Ÿ"
__email__ = "team@example.com"
__license__ = "MIT"
__description__ = "ä¸€ä¸ªç¤ºä¾‹PythonåŒ…"

# ç‰ˆæœ¬ä¿¡æ¯ç±»
class Version:
    def __init__(self, version_string):
        self.version_string = version_string
        self.parts = [int(x) for x in version_string.split('.')]
    
    def __str__(self):
        return self.version_string
    
    def __repr__(self):
        return f"Version('{self.version_string}')"
    
    def __eq__(self, other):
        return self.parts == other.parts
    
    def __lt__(self, other):
        return self.parts < other.parts

# ä½¿ç”¨ç‰ˆæœ¬ç±»
version = Version(__version__)

def get_package_info():
    """è·å–åŒ…çš„å®Œæ•´ä¿¡æ¯"""
    return {
        'name': __name__,
        'version': str(version),
        'author': __author__,
        'email': __email__,
        'license': __license__,
        'description': __description__
    }
```

### 3. æ’ä»¶ç³»ç»Ÿè®¾è®¡
```python
# åŸºäºåŒ…çš„æ’ä»¶ç³»ç»Ÿ
import pkgutil
import importlib

class PluginManager:
    """æ’ä»¶ç®¡ç†å™¨"""
    
    def __init__(self, plugin_package):
        self.plugin_package = plugin_package
        self.plugins = {}
    
    def load_plugins(self):
        """åŠ è½½æ‰€æœ‰æ’ä»¶"""
        # éå†æ’ä»¶åŒ…ä¸­çš„æ‰€æœ‰æ¨¡å—
        for importer, modname, ispkg in pkgutil.iter_modules(
            self.plugin_package.__path__, 
            self.plugin_package.__name__ + "."
        ):
            try:
                module = importlib.import_module(modname)
                if hasattr(module, 'register_plugin'):
                    plugin = module.register_plugin()
                    self.plugins[plugin.name] = plugin
                    print(f"åŠ è½½æ’ä»¶: {plugin.name}")
            except Exception as e:
                print(f"åŠ è½½æ’ä»¶{modname}å¤±è´¥: {e}")
    
    def get_plugin(self, name):
        """è·å–æŒ‡å®šæ’ä»¶"""
        return self.plugins.get(name)
    
    def list_plugins(self):
        """åˆ—å‡ºæ‰€æœ‰æ’ä»¶"""
        return list(self.plugins.keys())

# æ’ä»¶åŸºç±»
class Plugin:
    """æ’ä»¶åŸºç±»"""
    
    def __init__(self, name, version="1.0.0"):
        self.name = name
        self.version = version
    
    def execute(self, *args, **kwargs):
        """æ‰§è¡Œæ’ä»¶åŠŸèƒ½"""
        raise NotImplementedError("å­ç±»å¿…é¡»å®ç°executeæ–¹æ³•")
```

## ğŸ” æ¨¡å—æœç´¢å’Œå‘ç°

### 1. è‡ªå®šä¹‰æ¨¡å—æŸ¥æ‰¾å™¨
```python
import sys
import importlib.util
from pathlib import Path

class CustomFinder:
    """è‡ªå®šä¹‰æ¨¡å—æŸ¥æ‰¾å™¨"""
    
    def __init__(self, search_paths):
        self.search_paths = [Path(p) for p in search_paths]
    
    def find_spec(self, name, path, target=None):
        """æŸ¥æ‰¾æ¨¡å—è§„èŒƒ"""
        for search_path in self.search_paths:
            module_file = search_path / f"{name}.py"
            if module_file.exists():
                spec = importlib.util.spec_from_file_location(
                    name, module_file
                )
                return spec
        return None

# æ³¨å†Œè‡ªå®šä¹‰æŸ¥æ‰¾å™¨
custom_finder = CustomFinder(['/custom/modules/path'])
sys.meta_path.insert(0, custom_finder)
```

### 2. æ¨¡å—å‘ç°å·¥å…·
```python
import pkgutil
import importlib

def discover_modules(package_name):
    """å‘ç°åŒ…ä¸­çš„æ‰€æœ‰æ¨¡å—"""
    try:
        package = importlib.import_module(package_name)
    except ImportError:
        print(f"åŒ…{package_name}ä¸å­˜åœ¨")
        return []
    
    modules = []
    for importer, modname, ispkg in pkgutil.iter_modules(
        package.__path__, package.__name__ + "."
    ):
        modules.append({
            'name': modname,
            'is_package': ispkg,
            'importer': importer
        })
    
    return modules

# ä½¿ç”¨ç¤ºä¾‹
# modules = discover_modules('json')
# for module in modules:
#     print(f"æ¨¡å—: {module['name']}, æ˜¯åŒ…: {module['is_package']}")
```

## âš¡ æ€§èƒ½ä¼˜åŒ–

### 1. å»¶è¿Ÿå¯¼å…¥
```python
# å»¶è¿Ÿå¯¼å…¥å‡å°‘å¯åŠ¨æ—¶é—´
class DataProcessor:
    """æ•°æ®å¤„ç†å™¨ï¼Œä½¿ç”¨å»¶è¿Ÿå¯¼å…¥"""
    
    def __init__(self):
        self._pandas = None
        self._numpy = None
    
    @property
    def pandas(self):
        """å»¶è¿Ÿå¯¼å…¥pandas"""
        if self._pandas is None:
            try:
                import pandas as pd
                self._pandas = pd
            except ImportError:
                raise ImportError("éœ€è¦å®‰è£…pandas")
        return self._pandas
    
    @property
    def numpy(self):
        """å»¶è¿Ÿå¯¼å…¥numpy"""
        if self._numpy is None:
            try:
                import numpy as np
                self._numpy = np
            except ImportError:
                raise ImportError("éœ€è¦å®‰è£…numpy")
        return self._numpy
    
    def process_data(self, data):
        """å¤„ç†æ•°æ®"""
        # åªæœ‰åœ¨å®é™…ä½¿ç”¨æ—¶æ‰å¯¼å…¥
        df = self.pandas.DataFrame(data)
        array = self.numpy.array(data)
        return df, array
```

### 2. æ¨¡å—å¯¼å…¥æ—¶é—´åˆ†æ
```python
import time
import sys

class ImportTimer:
    """å¯¼å…¥æ—¶é—´åˆ†æå™¨"""
    
    def __init__(self):
        self.import_times = {}
    
    def time_import(self, module_name):
        """æµ‹é‡æ¨¡å—å¯¼å…¥æ—¶é—´"""
        # ç¡®ä¿æ¨¡å—ä¸åœ¨ç¼“å­˜ä¸­
        if module_name in sys.modules:
            del sys.modules[module_name]
        
        start_time = time.perf_counter()
        try:
            __import__(module_name)
            end_time = time.perf_counter()
            import_time = end_time - start_time
            self.import_times[module_name] = import_time
            return import_time
        except ImportError as e:
            print(f"å¯¼å…¥{module_name}å¤±è´¥: {e}")
            return None
    
    def analyze_imports(self, module_names):
        """åˆ†æå¤šä¸ªæ¨¡å—çš„å¯¼å…¥æ—¶é—´"""
        results = {}
        for module_name in module_names:
            import_time = self.time_import(module_name)
            if import_time is not None:
                results[module_name] = import_time
        
        # æŒ‰å¯¼å…¥æ—¶é—´æ’åº
        sorted_results = sorted(results.items(), key=lambda x: x[1], reverse=True)
        
        print("æ¨¡å—å¯¼å…¥æ—¶é—´åˆ†æ:")
        for module_name, import_time in sorted_results:
            print(f"{module_name}: {import_time:.4f}ç§’")
        
        return results

# ä½¿ç”¨ç¤ºä¾‹
# timer = ImportTimer()
# modules_to_test = ['json', 'os', 'sys', 'datetime', 'math']
# timer.analyze_imports(modules_to_test)
```

## ğŸ›¡ï¸ å®‰å…¨è€ƒè™‘

### 1. å®‰å…¨çš„åŠ¨æ€å¯¼å…¥
```python
import importlib
import sys

def safe_import(module_name, allowed_modules=None):
    """å®‰å…¨çš„åŠ¨æ€å¯¼å…¥"""
    # æ£€æŸ¥å…è®¸åˆ—è¡¨
    if allowed_modules and module_name not in allowed_modules:
        raise ImportError(f"æ¨¡å—{module_name}ä¸åœ¨å…è®¸åˆ—è¡¨ä¸­")
    
    # æ£€æŸ¥æ¨¡å—åçš„åˆæ³•æ€§
    if not module_name.replace('.', '').replace('_', '').isalnum():
        raise ImportError(f"æ¨¡å—å{module_name}åŒ…å«éæ³•å­—ç¬¦")
    
    # é™åˆ¶å¯¼å…¥æ·±åº¦
    if module_name.count('.') > 5:
        raise ImportError(f"æ¨¡å—{module_name}åµŒå¥—å±‚æ¬¡è¿‡æ·±")
    
    try:
        return importlib.import_module(module_name)
    except ImportError as e:
        print(f"å®‰å…¨å¯¼å…¥å¤±è´¥: {e}")
        return None

# ä½¿ç”¨ç¤ºä¾‹
allowed = ['json', 'os', 'sys', 'math']
module = safe_import('json', allowed)
```

### 2. æ¨¡å—å®Œæ•´æ€§æ£€æŸ¥
```python
import hashlib
import importlib.util

def verify_module_integrity(module_path, expected_hash):
    """éªŒè¯æ¨¡å—æ–‡ä»¶å®Œæ•´æ€§"""
    try:
        with open(module_path, 'rb') as f:
            content = f.read()
            actual_hash = hashlib.sha256(content).hexdigest()
            return actual_hash == expected_hash
    except Exception:
        return False

def secure_import_from_path(module_name, file_path, expected_hash=None):
    """å®‰å…¨åœ°ä»è·¯å¾„å¯¼å…¥æ¨¡å—"""
    # éªŒè¯æ–‡ä»¶å®Œæ•´æ€§
    if expected_hash and not verify_module_integrity(file_path, expected_hash):
        raise ImportError("æ¨¡å—æ–‡ä»¶å®Œæ•´æ€§éªŒè¯å¤±è´¥")
    
    # å¯¼å…¥æ¨¡å—
    spec = importlib.util.spec_from_file_location(module_name, file_path)
    if spec and spec.loader:
        module = importlib.util.module_from_spec(spec)
        spec.loader.exec_module(module)
        return module
    
    raise ImportError(f"æ— æ³•ä»{file_path}å¯¼å…¥æ¨¡å—{module_name}")
```

## ğŸ¯ æœ¬èŠ‚å°ç»“

- **æ¨¡å—å†…çœ**ï¼šä½¿ç”¨dir()ã€getattr()ã€hasattr()ç­‰å‡½æ•°æ£€æŸ¥æ¨¡å—å±æ€§
- **åŠ¨æ€å¯¼å…¥**ï¼šä½¿ç”¨importlibè¿›è¡Œè¿è¡Œæ—¶æ¨¡å—å¯¼å…¥å’Œé‡è½½
- **åŒ…çš„é«˜çº§ç‰¹æ€§**ï¼šå‘½åç©ºé—´åŒ…ã€å…ƒæ•°æ®ç®¡ç†ã€æ’ä»¶ç³»ç»Ÿ
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå»¶è¿Ÿå¯¼å…¥ã€å¯¼å…¥æ—¶é—´åˆ†æ
- **å®‰å…¨è€ƒè™‘**ï¼šå®‰å…¨çš„åŠ¨æ€å¯¼å…¥ã€æ¨¡å—å®Œæ•´æ€§æ£€æŸ¥

## ğŸ’¡ å®è·µå»ºè®®

1. **è°¨æ…ä½¿ç”¨åŠ¨æ€å¯¼å…¥**ï¼šåªåœ¨ç¡®å®éœ€è¦æ—¶ä½¿ç”¨ï¼Œæ³¨æ„å®‰å…¨æ€§
2. **åˆç†ä½¿ç”¨å»¶è¿Ÿå¯¼å…¥**ï¼šå¯¹äºå¤§å‹åº“æˆ–å¯é€‰ä¾èµ–ä½¿ç”¨å»¶è¿Ÿå¯¼å…¥
3. **æ¨¡å—ç¼“å­˜æœºåˆ¶**ï¼šç†è§£Pythonçš„æ¨¡å—ç¼“å­˜ï¼Œé¿å…é‡å¤å¯¼å…¥
4. **æ’ä»¶ç³»ç»Ÿè®¾è®¡**ï¼šä½¿ç”¨åŒ…çš„ç‰¹æ€§è®¾è®¡çµæ´»çš„æ’ä»¶ç³»ç»Ÿ

## ğŸ“š ä¸‹ä¸€æ­¥å­¦ä¹ 
å­¦ä¹ å®Œé«˜çº§ç‰¹æ€§åï¼Œæ¥ä¸‹æ¥å­¦ä¹  **[07-æœ€ä½³å®è·µ.md](./07-æœ€ä½³å®è·µ.md)**ï¼Œäº†è§£æ¨¡å—å’ŒåŒ…çš„å¼€å‘è§„èŒƒã€‚
