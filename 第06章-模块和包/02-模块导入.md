# 02-æ¨¡å—å¯¼å…¥

## ğŸ“¥ Pythonå¯¼å…¥è¯­å¥çš„æ‰€æœ‰ç»„åˆå½¢å¼

Pythonçš„å¯¼å…¥è¯­å¥éå¸¸çµæ´»ï¼Œæœ‰å¤šç§ç»„åˆæ–¹å¼ã€‚è®©æˆ‘ä»¬è¯¦ç»†äº†è§£æ¯ä¸€ç§ï¼š

### 1. åŸºæœ¬importè¯­å¥

#### 1.1 å¯¼å…¥å•ä¸ªæ¨¡å—
```python
import math
print(math.pi)      # 3.141592653589793
print(math.sqrt(16)) # 4.0
```

#### 1.2 å¯¼å…¥å¤šä¸ªæ¨¡å—
```python
# æ–¹å¼1ï¼šä¸€è¡Œå¯¼å…¥å¤šä¸ªï¼ˆä¸æ¨èï¼Œè¿åPEP8ï¼‰
import os, sys, json

# æ–¹å¼2ï¼šåˆ†è¡Œå¯¼å…¥ï¼ˆæ¨èï¼‰
import os
import sys
import json
```

#### 1.3 å¯¼å…¥å­æ¨¡å—
```python
import urllib.parse
import xml.etree.ElementTree
import email.mime.text

# ä½¿ç”¨æ—¶éœ€è¦å®Œæ•´è·¯å¾„
parsed = urllib.parse.urlparse('https://example.com')
```

### 2. å¸¦åˆ«åçš„importè¯­å¥

#### 2.1 æ¨¡å—åˆ«å
```python
# å¸¸è§çš„çº¦å®šä¿—æˆçš„åˆ«å
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import tensorflow as tf

# è‡ªå®šä¹‰åˆ«å
import very_long_module_name as vlmn
import my_custom_module as mcm
```

#### 2.2 å­æ¨¡å—åˆ«å
```python
import urllib.parse as urlparse
import xml.etree.ElementTree as ET
import collections.defaultdict as defaultdict

# ä½¿ç”¨åˆ«å
parsed = urlparse.urlparse('https://example.com')
tree = ET.parse('data.xml')
```

### 3. from A import B çš„å®Œæ•´ç»„åˆåˆ†æ

`from A import B` è¯­å¥ä¸­ï¼ŒA å’Œ B å¯ä»¥æœ‰å¤šç§ç»„åˆã€‚è®©æˆ‘ä»¬è¯¦ç»†åˆ†ææ¯ç§å¯èƒ½æ€§ï¼š

#### 3.1 A çš„æ‰€æœ‰å¯èƒ½å½¢å¼

**A å¯ä»¥æ˜¯ï¼š**
1. **æ¨¡å—å** - `from math import ...`
2. **åŒ…å** - `from collections import ...`
3. **å­æ¨¡å—è·¯å¾„** - `from urllib.parse import ...`
4. **æ·±å±‚åµŒå¥—è·¯å¾„** - `from xml.etree.ElementTree import ...`
5. **ç›¸å¯¹è·¯å¾„** - `from . import ...` æˆ– `from .. import ...`

#### 3.2 B çš„æ‰€æœ‰å¯èƒ½å½¢å¼

**B å¯ä»¥æ˜¯ï¼š**
1. **å‡½æ•°å** - `from math import sqrt`
2. **ç±»å** - `from datetime import datetime`
3. **å˜é‡/å¸¸é‡å** - `from os import sep`
4. **å­æ¨¡å—å** - `from urllib import parse`
5. **é€šé…ç¬¦** - `from math import *`
6. **å¤šä¸ªå¯¹è±¡** - `from math import pi, sqrt, sin`
7. **å¸¦åˆ«åçš„å¯¹è±¡** - `from math import sqrt as square_root`

#### 3.3 æœ‰æ•ˆç»„åˆç¤ºä¾‹

##### ç»„åˆ1ï¼šæ¨¡å— + å‡½æ•°/ç±»/å˜é‡
```python
# âœ… æœ‰æ•ˆï¼šä»æ¨¡å—å¯¼å…¥å‡½æ•°
from math import sqrt, sin, cos, pi
from random import randint, choice, shuffle

# âœ… æœ‰æ•ˆï¼šä»æ¨¡å—å¯¼å…¥ç±»
from datetime import datetime, date, timedelta
from pathlib import Path
from decimal import Decimal

# âœ… æœ‰æ•ˆï¼šä»æ¨¡å—å¯¼å…¥å¸¸é‡/å˜é‡
from os import sep, pathsep, linesep
from sys import version, platform, maxsize
```

##### ç»„åˆ2ï¼šåŒ… + å­æ¨¡å—
```python
# âœ… æœ‰æ•ˆï¼šä»åŒ…å¯¼å…¥å­æ¨¡å—
from urllib import parse, request, error
from xml import etree, dom, sax
from email import mime, header, utils
from collections import abc, defaultdict, Counter
```

##### ç»„åˆ3ï¼šå­æ¨¡å—è·¯å¾„ + å¯¹è±¡
```python
# âœ… æœ‰æ•ˆï¼šä»å­æ¨¡å—å¯¼å…¥å¯¹è±¡
from urllib.parse import urlparse, urljoin, quote
from xml.etree.ElementTree import parse, Element, SubElement
from email.mime.text import MIMEText
from collections.abc import Mapping, Sequence
```

##### ç»„åˆ4ï¼šæ·±å±‚åµŒå¥— + å¯¹è±¡
```python
# âœ… æœ‰æ•ˆï¼šä»æ·±å±‚åµŒå¥—æ¨¡å—å¯¼å…¥
from xml.etree.ElementTree import parse as xml_parse
from email.mime.multipart import MIMEMultipart
from urllib.request import urlopen, Request
from http.client import HTTPConnection, HTTPSConnection
```

##### ç»„åˆ5ï¼šç›¸å¯¹å¯¼å…¥ + å¯¹è±¡
```python
# âœ… æœ‰æ•ˆï¼šç›¸å¯¹å¯¼å…¥ï¼ˆä»…åœ¨åŒ…å†…ä½¿ç”¨ï¼‰
from . import sibling_module
from .utils import helper_function, HelperClass
from ..parent import parent_function
from ...grandparent import grand_function
```

##### ç»„åˆ6ï¼šæ··åˆå¯¼å…¥å’Œé‡å‘½å
```python
# âœ… æœ‰æ•ˆï¼šåŒæ—¶å¯¼å…¥å¤šä¸ªå¯¹è±¡ï¼Œéƒ¨åˆ†é‡å‘½å
from datetime import (
    datetime,
    date as Date,
    timedelta as Delta,
    timezone
)

from os import (
    getcwd,
    listdir as ls,
    makedirs,
    path
)
```

#### 3.4 æ— æ•ˆç»„åˆå’Œé™åˆ¶

##### æ— æ•ˆç»„åˆ1ï¼šä¸å­˜åœ¨çš„æ¨¡å—/åŒ…
```python
# âŒ æ— æ•ˆï¼šæ¨¡å—ä¸å­˜åœ¨
from nonexistent_module import something
# ImportError: No module named 'nonexistent_module'

# âŒ æ— æ•ˆï¼šåŒ…ä¸å­˜åœ¨
from fake_package import fake_module
# ImportError: No module named 'fake_package'
```

##### æ— æ•ˆç»„åˆ2ï¼šä¸å­˜åœ¨çš„å¯¹è±¡
```python
# âŒ æ— æ•ˆï¼šå¯¹è±¡ä¸å­˜åœ¨
from math import nonexistent_function
# ImportError: cannot import name 'nonexistent_function' from 'math'

from os import fake_variable
# ImportError: cannot import name 'fake_variable' from 'os'
```

##### æ— æ•ˆç»„åˆ3ï¼šç§æœ‰å¯¹è±¡ï¼ˆçº¦å®šï¼‰
```python
# âŒ ä¸æ¨èï¼šå¯¼å…¥ç§æœ‰å¯¹è±¡ï¼ˆä»¥ä¸‹åˆ’çº¿å¼€å¤´ï¼‰
from some_module import _private_function
# è™½ç„¶æŠ€æœ¯ä¸Šå¯èƒ½æˆåŠŸï¼Œä½†è¿åäº†Pythonçº¦å®š

# âŒ ä¸æ¨èï¼šå¯¼å…¥å†…éƒ¨å®ç°ç»†èŠ‚
from some_module import __internal_method
```

##### æ— æ•ˆç»„åˆ4ï¼šå¾ªç¯å¯¼å…¥
```python
# âŒ æ— æ•ˆï¼šå¾ªç¯å¯¼å…¥
# module_a.py
from module_b import function_b

# module_b.py
from module_a import function_a
# å¯èƒ½å¯¼è‡´ ImportError æˆ–éƒ¨åˆ†å¯¼å…¥
```

##### æ— æ•ˆç»„åˆ5ï¼šç›¸å¯¹å¯¼å…¥çš„é™åˆ¶
```python
# âŒ æ— æ•ˆï¼šåœ¨é¡¶çº§è„šæœ¬ä¸­ä½¿ç”¨ç›¸å¯¹å¯¼å…¥
from . import something
# ImportError: attempted relative import with no known parent package

# âŒ æ— æ•ˆï¼šè¶…å‡ºåŒ…è¾¹ç•Œçš„ç›¸å¯¹å¯¼å…¥
from .... import something  # å¦‚æœåªæœ‰3å±‚åµŒå¥—
# ImportError: attempted relative import beyond top-level package
```

#### 3.5 ç‰¹æ®Šæƒ…å†µå’Œè¾¹ç•Œæ¡ä»¶

##### æƒ…å†µ1ï¼š__all__ çš„å½±å“
```python
# module.py
__all__ = ['public_function', 'PublicClass']

def public_function():
    pass

def _private_function():
    pass

class PublicClass:
    pass

# ä½¿ç”¨æ—¶ï¼š
from module import *  # åªå¯¼å…¥ __all__ ä¸­çš„å†…å®¹
# âœ… å¯ä»¥ä½¿ç”¨ï¼špublic_function, PublicClass
# âŒ ä¸èƒ½ä½¿ç”¨ï¼š_private_function
```

##### æƒ…å†µ2ï¼šåŠ¨æ€å±æ€§
```python
# âœ… æœ‰æ•ˆï¼šå¯¼å…¥åŠ¨æ€åˆ›å»ºçš„å±æ€§
from types import SimpleNamespace
ns = SimpleNamespace()
ns.dynamic_attr = "value"

# ä½†è¿™ç§æƒ…å†µä¸‹ä¸èƒ½ç”¨ from...import
# from ns import dynamic_attr  # è¿™ä¸æ˜¯æ¨¡å—å¯¼å…¥
```

##### æƒ…å†µ3ï¼šå±æ€§è®¿é—® vs å¯¼å…¥
```python
# âœ… æœ‰æ•ˆï¼šå±æ€§è®¿é—®
import math
value = math.pi

# âœ… æœ‰æ•ˆï¼šå¯¼å…¥
from math import pi
value = pi

# âŒ æ··æ·†ï¼šä¸èƒ½ä»å®ä¾‹å¯¼å…¥
obj = SomeClass()
# from obj import method  # è¿™ä¸æ˜¯æœ‰æ•ˆçš„è¯­æ³•
```

#### 3.6 å¤æ‚ç»„åˆç¤ºä¾‹

##### ç¤ºä¾‹1ï¼šå¤šå±‚åµŒå¥— + å¤šå¯¹è±¡ + é‡å‘½å
```python
# âœ… å¤æ‚ä½†æœ‰æ•ˆçš„ç»„åˆ
from xml.etree.ElementTree import (
    parse as xml_parse,
    Element,
    SubElement as Sub,
    tostring
)

from urllib.parse import (
    urlparse,
    urljoin as join_url,
    quote,
    unquote as decode_url
)
```

##### ç¤ºä¾‹2ï¼šæ¡ä»¶å¯¼å…¥ç»„åˆ
```python
# âœ… æœ‰æ•ˆï¼šæ¡ä»¶æ€§çš„å¤æ‚å¯¼å…¥
try:
    from collections.abc import Mapping, Sequence
except ImportError:
    # Python < 3.3 å…¼å®¹æ€§
    from collections import Mapping, Sequence

try:
    from functools import lru_cache
except ImportError:
    # æä¾›å¤‡ç”¨å®ç°
    def lru_cache(maxsize=None):
        def decorator(func):
            return func
        return decorator
```

#### 3.7 è¯­æ³•è§„åˆ™æ€»ç»“

**æœ‰æ•ˆçš„ Aï¼ˆæ¥æºï¼‰ï¼š**
- ä»»ä½•å¯å¯¼å…¥çš„æ¨¡å—å
- ä»»ä½•å¯å¯¼å…¥çš„åŒ…å
- ä»»ä½•æœ‰æ•ˆçš„æ¨¡å—è·¯å¾„ï¼ˆç”¨ç‚¹åˆ†éš”ï¼‰
- ç›¸å¯¹å¯¼å…¥è·¯å¾„ï¼ˆåœ¨åŒ…å†…ï¼‰

**æœ‰æ•ˆçš„ Bï¼ˆç›®æ ‡ï¼‰ï¼š**
- æ¨¡å—/åŒ…ä¸­å­˜åœ¨çš„ä»»ä½•å…¬å…±å±æ€§
- å‡½æ•°åã€ç±»åã€å˜é‡åã€å¸¸é‡å
- å­æ¨¡å—åï¼ˆå½“Aæ˜¯åŒ…æ—¶ï¼‰
- `*`ï¼ˆé€šé…ç¬¦ï¼Œå¯¼å…¥æ‰€æœ‰å…¬å…±å¯¹è±¡ï¼‰
- å¤šä¸ªå¯¹è±¡ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰
- å¸¦åˆ«åçš„å¯¹è±¡ï¼ˆä½¿ç”¨ `as`ï¼‰

**æ— æ•ˆçš„ç»„åˆï¼š**
- ä¸å­˜åœ¨çš„æ¨¡å—/åŒ…/å¯¹è±¡
- åœ¨é”™è¯¯ä¸Šä¸‹æ–‡ä¸­çš„ç›¸å¯¹å¯¼å…¥
- å¾ªç¯å¯¼å…¥ï¼ˆå¯èƒ½å¯¼è‡´é—®é¢˜ï¼‰
- è¿åè®¿é—®çº¦å®šçš„ç§æœ‰å¯¹è±¡å¯¼å…¥

#### 3.8 å®é™…æµ‹è¯•ç¤ºä¾‹

è®©æˆ‘ä»¬é€šè¿‡å®é™…ä»£ç æ¥æµ‹è¯•å„ç§ç»„åˆï¼š

```python
# æµ‹è¯•è„šæœ¬ï¼štest_import_combinations.py

def test_valid_combinations():
    """æµ‹è¯•æœ‰æ•ˆçš„å¯¼å…¥ç»„åˆ"""

    print("=== æµ‹è¯•æœ‰æ•ˆç»„åˆ ===")

    # 1. åŸºæœ¬æ¨¡å—å¯¼å…¥
    try:
        from math import pi, sqrt, sin
        print(f"âœ… ä»mathå¯¼å…¥å‡½æ•°: Ï€={pi:.3f}, âˆš16={sqrt(16)}")
    except ImportError as e:
        print(f"âŒ å¯¼å…¥å¤±è´¥: {e}")

    # 2. åŒ…çš„å­æ¨¡å—å¯¼å…¥
    try:
        from urllib import parse
        from urllib.parse import urlparse
        url = urlparse("https://example.com/path")
        print(f"âœ… ä»urllib.parseå¯¼å…¥: {url.netloc}")
    except ImportError as e:
        print(f"âŒ å¯¼å…¥å¤±è´¥: {e}")

    # 3. æ·±å±‚åµŒå¥—å¯¼å…¥
    try:
        from xml.etree.ElementTree import Element, tostring
        elem = Element("test")
        print(f"âœ… ä»xml.etree.ElementTreeå¯¼å…¥: {type(elem)}")
    except ImportError as e:
        print(f"âŒ å¯¼å…¥å¤±è´¥: {e}")

    # 4. å¤šå¯¹è±¡å¯¼å…¥å’Œé‡å‘½å
    try:
        from datetime import datetime as dt, date as Date
        now = dt.now()
        today = Date.today()
        print(f"âœ… é‡å‘½åå¯¼å…¥: {now.year}-{today.month}")
    except ImportError as e:
        print(f"âŒ å¯¼å…¥å¤±è´¥: {e}")

def test_invalid_combinations():
    """æµ‹è¯•æ— æ•ˆçš„å¯¼å…¥ç»„åˆ"""

    print("\n=== æµ‹è¯•æ— æ•ˆç»„åˆ ===")

    # 1. ä¸å­˜åœ¨çš„æ¨¡å—
    try:
        from nonexistent_module import something
        print("âŒ ä¸åº”è¯¥æˆåŠŸ")
    except ImportError as e:
        print(f"âœ… é¢„æœŸçš„é”™è¯¯: {e}")

    # 2. ä¸å­˜åœ¨çš„å¯¹è±¡
    try:
        from math import nonexistent_function
        print("âŒ ä¸åº”è¯¥æˆåŠŸ")
    except ImportError as e:
        print(f"âœ… é¢„æœŸçš„é”™è¯¯: {e}")

    # 3. é”™è¯¯çš„è·¯å¾„
    try:
        from math.nonexistent import something
        print("âŒ ä¸åº”è¯¥æˆåŠŸ")
    except ImportError as e:
        print(f"âœ… é¢„æœŸçš„é”™è¯¯: {e}")

def test_edge_cases():
    """æµ‹è¯•è¾¹ç•Œæƒ…å†µ"""

    print("\n=== æµ‹è¯•è¾¹ç•Œæƒ…å†µ ===")

    # 1. å¯¼å…¥ç§æœ‰å¯¹è±¡ï¼ˆæŠ€æœ¯ä¸Šå¯èƒ½ï¼Œä½†ä¸æ¨èï¼‰
    try:
        import sys
        # æŸäº›æ¨¡å—å¯èƒ½æœ‰ç§æœ‰å¯¹è±¡
        from sys import _getframe  # è¿™æ˜¯ä¸€ä¸ªç§æœ‰å‡½æ•°
        print("âš ï¸  å¯¼å…¥ç§æœ‰å¯¹è±¡æˆåŠŸï¼ˆä¸æ¨èï¼‰")
    except ImportError as e:
        print(f"âœ… ç§æœ‰å¯¹è±¡å¯¼å…¥å¤±è´¥: {e}")

    # 2. æµ‹è¯• __all__ çš„å½±å“
    try:
        # åˆ›å»ºä¸€ä¸ªæµ‹è¯•æ¨¡å—æ¥æ¼”ç¤º __all__
        import tempfile
        import os

        # åŠ¨æ€åˆ›å»ºæµ‹è¯•æ¨¡å—
        test_module_content = '''
__all__ = ['public_func']

def public_func():
    return "public"

def _private_func():
    return "private"

def another_func():
    return "another"
'''

        with tempfile.NamedTemporaryFile(mode='w', suffix='.py', delete=False) as f:
            f.write(test_module_content)
            f.flush()

            # åŠ¨æ€å¯¼å…¥æµ‹è¯•
            import importlib.util
            spec = importlib.util.spec_from_file_location("test_module", f.name)
            test_module = importlib.util.module_from_spec(spec)
            spec.loader.exec_module(test_module)

            # æµ‹è¯• from module import *
            print(f"æ¨¡å—çš„ __all__: {test_module.__all__}")
            print(f"public_func å­˜åœ¨: {hasattr(test_module, 'public_func')}")
            print(f"_private_func å­˜åœ¨: {hasattr(test_module, '_private_func')}")
            print(f"another_func å­˜åœ¨: {hasattr(test_module, 'another_func')}")

        # æ¸…ç†
        os.unlink(f.name)

    except Exception as e:
        print(f"è¾¹ç•Œæµ‹è¯•å‡ºé”™: {e}")

def test_import_variations():
    """æµ‹è¯•å¯¼å…¥çš„å„ç§å˜ä½“"""

    print("\n=== æµ‹è¯•å¯¼å…¥å˜ä½“ ===")

    # 1. åŒä¸€å¯¹è±¡çš„ä¸åŒå¯¼å…¥æ–¹å¼
    import math
    from math import pi
    from math import pi as PI

    print(f"import math: math.pi = {math.pi}")
    print(f"from math import pi: pi = {pi}")
    print(f"from math import pi as PI: PI = {PI}")
    print(f"ä¸‰ç§æ–¹å¼ç»“æœç›¸åŒ: {math.pi == pi == PI}")

    # 2. å¤šç§è·¯å¾„è®¿é—®åŒä¸€å¯¹è±¡
    import urllib.parse
    from urllib import parse
    from urllib.parse import urlparse

    url = "https://example.com"
    result1 = urllib.parse.urlparse(url)
    result2 = parse.urlparse(url)
    result3 = urlparse(url)

    print(f"ä¸‰ç§è®¿é—®æ–¹å¼ç»“æœç›¸åŒ: {result1 == result2 == result3}")

if __name__ == "__main__":
    test_valid_combinations()
    test_invalid_combinations()
    test_edge_cases()
    test_import_variations()
```

#### 3.9 ç»„åˆè§„åˆ™çš„è®°å¿†å£è¯€

ä¸ºäº†å¸®åŠ©è®°å¿†ï¼Œè¿™é‡Œæä¾›ä¸€äº›è§„åˆ™ï¼š

**Aï¼ˆæ¥æºï¼‰çš„è§„åˆ™ï¼š**
- "Aå¿…é¡»æ˜¯å¯å¯¼å…¥çš„è·¯å¾„"
- "ç‚¹å·è¿æ¥çš„æ¯ä¸€æ®µéƒ½å¿…é¡»å­˜åœ¨"
- "ç›¸å¯¹å¯¼å…¥åªèƒ½åœ¨åŒ…å†…ä½¿ç”¨"

**Bï¼ˆç›®æ ‡ï¼‰çš„è§„åˆ™ï¼š**
- "Bå¿…é¡»æ˜¯Aä¸­å­˜åœ¨çš„å±æ€§"
- "Bå¯ä»¥æ˜¯å‡½æ•°ã€ç±»ã€å˜é‡ã€å­æ¨¡å—"
- "Bå¯ä»¥ç”¨é€—å·åˆ†éš”å¤šä¸ªï¼Œç”¨asé‡å‘½å"

**ç»„åˆæœ‰æ•ˆæ€§æ£€æŸ¥ï¼š**
1. Aå­˜åœ¨å—ï¼Ÿï¼ˆæ¨¡å—/åŒ…æ˜¯å¦å¯å¯¼å…¥ï¼‰
2. Båœ¨Aä¸­å­˜åœ¨å—ï¼Ÿï¼ˆå±æ€§æ˜¯å¦å­˜åœ¨ï¼‰
3. Bæ˜¯å…¬å…±çš„å—ï¼Ÿï¼ˆä¸è¿åç§æœ‰çº¦å®šï¼‰
4. ä¸Šä¸‹æ–‡æ­£ç¡®å—ï¼Ÿï¼ˆç›¸å¯¹å¯¼å…¥çš„ä½ç½®ï¼‰

#### 3.10 å¸¸è§é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆ

```python
# é”™è¯¯1ï¼šè·¯å¾„é”™è¯¯
# âŒ from math.sqrt import something  # math.sqrtæ˜¯å‡½æ•°ï¼Œä¸æ˜¯æ¨¡å—
# âœ… from math import sqrt

# é”™è¯¯2ï¼šå¯¹è±¡ä¸å­˜åœ¨
# âŒ from os import nonexistent
# âœ… from os import getcwd  # ä½¿ç”¨å­˜åœ¨çš„å¯¹è±¡

# é”™è¯¯3ï¼šç›¸å¯¹å¯¼å…¥ä½ç½®é”™è¯¯
# âŒ åœ¨é¡¶çº§è„šæœ¬ä¸­: from . import something
# âœ… åœ¨åŒ…å†…æ¨¡å—ä¸­: from . import sibling

# é”™è¯¯4ï¼šå¾ªç¯å¯¼å…¥
# âŒ module_aå¯¼å…¥module_bï¼Œmodule_båˆå¯¼å…¥module_a
# âœ… é‡æ„ä»£ç ï¼Œæå–å…¬å…±éƒ¨åˆ†åˆ°ç¬¬ä¸‰ä¸ªæ¨¡å—

# é”™è¯¯5ï¼šç§æœ‰å¯¹è±¡å¯¼å…¥
# âŒ from module import _private_func  # è¿åçº¦å®š
# âœ… from module import public_func   # ä½¿ç”¨å…¬å…±æ¥å£
```

#### 3.11 å®Œæ•´ç»„åˆå¯¹ç…§è¡¨

| Aï¼ˆæ¥æºï¼‰ç±»å‹ | A ç¤ºä¾‹ | Bï¼ˆç›®æ ‡ï¼‰ç±»å‹ | B ç¤ºä¾‹ | ç»„åˆç¤ºä¾‹ | æœ‰æ•ˆæ€§ |
|-------------|--------|-------------|--------|----------|--------|
| æ¨¡å—å | `math` | å‡½æ•° | `sqrt` | `from math import sqrt` | âœ… |
| æ¨¡å—å | `os` | å˜é‡ | `sep` | `from os import sep` | âœ… |
| æ¨¡å—å | `datetime` | ç±» | `datetime` | `from datetime import datetime` | âœ… |
| åŒ…å | `urllib` | å­æ¨¡å— | `parse` | `from urllib import parse` | âœ… |
| å­æ¨¡å—è·¯å¾„ | `urllib.parse` | å‡½æ•° | `urlparse` | `from urllib.parse import urlparse` | âœ… |
| æ·±å±‚è·¯å¾„ | `xml.etree.ElementTree` | ç±» | `Element` | `from xml.etree.ElementTree import Element` | âœ… |
| ç›¸å¯¹è·¯å¾„ | `.` | æ¨¡å— | `sibling` | `from . import sibling` | âœ…* |
| ç›¸å¯¹è·¯å¾„ | `..` | å‡½æ•° | `parent_func` | `from .. import parent_func` | âœ…* |
| æ¨¡å—å | `math` | é€šé…ç¬¦ | `*` | `from math import *` | âš ï¸ |
| æ¨¡å—å | `math` | å¤šå¯¹è±¡ | `pi, sqrt` | `from math import pi, sqrt` | âœ… |
| æ¨¡å—å | `math` | å¸¦åˆ«å | `sqrt as sq` | `from math import sqrt as sq` | âœ… |
| ä¸å­˜åœ¨æ¨¡å— | `fake` | ä»»ä½• | `anything` | `from fake import anything` | âŒ |
| å­˜åœ¨æ¨¡å— | `math` | ä¸å­˜åœ¨å¯¹è±¡ | `fake` | `from math import fake` | âŒ |
| å‡½æ•°è·¯å¾„ | `math.sqrt` | ä»»ä½• | `anything` | `from math.sqrt import anything` | âŒ |
| é¡¶çº§è„šæœ¬ | `.` | ä»»ä½• | `anything` | `from . import anything` | âŒ |

**è¯´æ˜ï¼š**
- âœ… = æœ‰æ•ˆç»„åˆ
- âŒ = æ— æ•ˆç»„åˆ
- âš ï¸ = æœ‰æ•ˆä½†ä¸æ¨è
- \* = ä»…åœ¨åŒ…å†…æœ‰æ•ˆ

#### 3.12 å®ç”¨å†³ç­–æ ‘

å½“ä½ æƒ³å†™ `from A import B` æ—¶ï¼ŒæŒ‰ä»¥ä¸‹æ­¥éª¤æ£€æŸ¥ï¼š

```
1. A æ˜¯å¦æ˜¯æœ‰æ•ˆçš„æ¨¡å—/åŒ…è·¯å¾„ï¼Ÿ
   â”œâ”€ å¦ â†’ âŒ æ— æ•ˆ
   â””â”€ æ˜¯ â†’ ç»§ç»­

2. A æ˜¯å¦å¯ä»¥è¢«å¯¼å…¥ï¼Ÿ
   â”œâ”€ å¦ â†’ âŒ ImportError
   â””â”€ æ˜¯ â†’ ç»§ç»­

3. B åœ¨ A ä¸­å­˜åœ¨å—ï¼Ÿ
   â”œâ”€ å¦ â†’ âŒ ImportError: cannot import name 'B'
   â””â”€ æ˜¯ â†’ ç»§ç»­

4. å¦‚æœ A æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œå½“å‰æ˜¯å¦åœ¨åŒ…å†…ï¼Ÿ
   â”œâ”€ å¦ â†’ âŒ ImportError: attempted relative import
   â””â”€ æ˜¯/ä¸é€‚ç”¨ â†’ ç»§ç»­

5. B æ˜¯å¦æ˜¯å…¬å…±å¯¹è±¡ï¼ˆä¸ä»¥_å¼€å¤´ï¼‰ï¼Ÿ
   â”œâ”€ å¦ â†’ âš ï¸ æŠ€æœ¯ä¸Šå¯èƒ½ï¼Œä½†ä¸æ¨è
   â””â”€ æ˜¯ â†’ âœ… æœ‰æ•ˆç»„åˆ
```

### 4. å¤æ‚çš„from...importç»„åˆ

#### 4.1 ä»å­æ¨¡å—å¯¼å…¥
```python
# ä»åŒ…çš„å­æ¨¡å—å¯¼å…¥
from urllib.parse import urlparse, urljoin
from xml.etree.ElementTree import parse, Element
from email.mime.text import MIMEText
from http.client import HTTPConnection

# ä»æ·±å±‚åµŒå¥—çš„æ¨¡å—å¯¼å…¥
from my_package.sub_package.module import function
from django.contrib.auth.models import User
```

#### 4.2 æ··åˆå¯¼å…¥å’Œé‡å‘½å
```python
# åŒæ—¶å¯¼å…¥å¤šä¸ªå¯¹è±¡å¹¶é‡å‘½åéƒ¨åˆ†
from datetime import (
    datetime,
    date as Date,
    timedelta as TimeDelta,
    timezone
)

# ä»åŒä¸€æ¨¡å—å¯¼å…¥ä¸åŒç±»å‹çš„å¯¹è±¡
from os import (
    getcwd,           # å‡½æ•°
    environ,          # å˜é‡
    PathLike,         # ç±»å‹
    sep as separator  # å¸¸é‡å¹¶é‡å‘½å
)
```

### 5. ç›¸å¯¹å¯¼å…¥ï¼ˆä»…åœ¨åŒ…å†…ä½¿ç”¨ï¼‰

#### 5.1 åŒçº§å¯¼å…¥
```python
# åœ¨åŒ…å†…çš„æ¨¡å—ä¸­
from . import sibling_module
from .sibling_module import some_function
from .sibling_module import SomeClass as SC
```

#### 5.2 ä¸Šçº§å¯¼å…¥
```python
# å¯¼å…¥çˆ¶çº§åŒ…çš„æ¨¡å—
from .. import parent_module
from ..parent_module import parent_function

# å¯¼å…¥ç¥–çˆ¶çº§åŒ…çš„æ¨¡å—
from ... import grandparent_module
```

#### 5.3 å…„å¼ŸåŒ…å¯¼å…¥
```python
# å¯¼å…¥å…„å¼ŸåŒ…çš„æ¨¡å—
from ..sibling_package import module
from ..sibling_package.module import function
```

#### 5.4 ç›¸å¯¹å¯¼å…¥çš„è¾¹ç•Œï¼šä¸èƒ½è¶…è¶Šé¡¶çº§åŒ…
ä¸€ä¸ªå¸¸è§çš„é—®é¢˜æ˜¯ï¼šå¯ä»¥ç”¨ `..` æ— é™åœ°å‘ä¸Šå¯¼å…¥å—ï¼Ÿåªè¦ä¸Šçº§æœ‰ç›®å½•å°±è¡Œï¼Ÿ

ç­”æ¡ˆæ˜¯ï¼š**ä¸å¯ä»¥**ï¼Œç›¸å¯¹å¯¼å…¥å­˜åœ¨ä¸€ä¸ªæ— æ³•é€¾è¶Šçš„ç¡¬æ€§é™åˆ¶â€”â€”**é¡¶çº§åŒ…ï¼ˆTop-level Packageï¼‰**ã€‚

**é¡¶çº§åŒ…**é€šå¸¸æ˜¯Pythonè§£é‡Šå™¨å¼€å§‹æ‰§è¡Œæ—¶ï¼Œå…¶æœç´¢è·¯å¾„(`sys.path`)ä¸Šçš„é‚£ä¸ªåŒ…çš„æ ¹ç›®å½•ã€‚ä»»ä½•è¯•å›¾ç”¨ `..` è¶…è¶Šè¿™ä¸ªæ ¹ç›®å½•çš„å¯¼å…¥éƒ½ä¼šå¤±è´¥ã€‚

**ç¤ºä¾‹ï¼š**
å‡è®¾æœ‰å¦‚ä¸‹ç»“æ„ï¼Œä¸” `my_project` ç›®å½•åœ¨ `sys.path` ä¸­ï¼Œä½¿å…¶æˆä¸ºé¡¶çº§åŒ…ã€‚
```
my_project/
â””â”€â”€ my_app/               <-- é¡¶çº§åŒ…
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ core/
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â””â”€â”€ engine.py     <-- æˆ‘ä»¬åœ¨è¿™é‡Œå†™ä»£ç 
    â””â”€â”€ utils/
        â”œâ”€â”€ __init__.py
        â””â”€â”€ helpers.py
```

åœ¨ `my_app/core/engine.py` æ–‡ä»¶ä¸­ï¼š
- `from ..utils import helpers` æ˜¯ **åˆæ³•** çš„ã€‚å®ƒä» `core` ä¸Šå‡åˆ° `my_app`ï¼Œç„¶åè¿›å…¥ `utils`ã€‚
- `from ... import some_other_app` æ˜¯ **éæ³•** çš„ã€‚å®ƒè¯•å›¾ä» `my_app` å†å‘ä¸Šä¸€å±‚ï¼Œè¿™è¶…è¶Šäº†é¡¶çº§åŒ…çš„è¾¹ç•Œã€‚

å½“ä½ å°è¯•è¿™ç§éæ³•çš„å¯¼å…¥æ—¶ï¼ŒPythonä¼šæŠ›å‡ºéå¸¸æ˜ç¡®çš„é”™è¯¯ï¼š
```
ImportError: attempted relative import beyond top-level package
```

è¿™ä¸ªé™åˆ¶æ˜¯Pythonæœ‰æ„ä¸ºä¹‹ï¼Œç›®çš„æ˜¯ä¸ºäº†ä¿è¯åŒ…çš„**å°è£…æ€§**å’Œ**å¯ç§»æ¤æ€§**ã€‚ä¸€ä¸ªè®¾è®¡è‰¯å¥½çš„åŒ…åº”è¯¥æ˜¯è‡ªåŒ…å«çš„ï¼Œä¸åº”è¯¥ä¾èµ–ä»»ä½•ä½äºå…¶å¤–éƒ¨ã€ä½ç½®ä¸ç¡®å®šçš„æ–‡ä»¶ã€‚

### 6. æ¡ä»¶å¯¼å…¥

#### 6.1 å¼‚å¸¸å¤„ç†å¯¼å…¥
```python
# å¤„ç†å¯é€‰ä¾èµ–
try:
    import numpy as np
    HAS_NUMPY = True
except ImportError:
    HAS_NUMPY = False
    np = None

# å¤šä¸ªå¤‡é€‰æ–¹æ¡ˆ
try:
    from collections import OrderedDict
except ImportError:
    # Python 2.6 å…¼å®¹æ€§
    from ordereddict import OrderedDict

# åŠŸèƒ½æ£€æµ‹å¯¼å…¥
try:
    from functools import lru_cache
except ImportError:
    # ä¸ºæ—§ç‰ˆæœ¬æä¾›ç®€å•å®ç°
    def lru_cache(maxsize=None):
        def decorator(func):
            return func
        return decorator
```

#### 6.2 ç‰ˆæœ¬æ¡ä»¶å¯¼å…¥
```python
import sys

# åŸºäºPythonç‰ˆæœ¬çš„æ¡ä»¶å¯¼å…¥
if sys.version_info >= (3, 8):
    from functools import cached_property
else:
    cached_property = property

if sys.version_info >= (3, 9):
    from collections.abc import Mapping
else:
    from collections import Mapping

# åŸºäºå¹³å°çš„æ¡ä»¶å¯¼å…¥
import platform
if platform.system() == 'Windows':
    import winsound as sound
elif platform.system() == 'Darwin':
    import subprocess as sound
else:
    sound = None
```

### 7. åŠ¨æ€å¯¼å…¥

#### 7.1 ä½¿ç”¨__import__
```python
# åŠ¨æ€å¯¼å…¥æ¨¡å—
module_name = 'json'
json_module = __import__(module_name)

# åŠ¨æ€å¯¼å…¥åŒ…çš„å­æ¨¡å—
urllib_parse = __import__('urllib.parse', fromlist=[''])
```

#### 7.2 ä½¿ç”¨importlib
```python
import importlib

# åŠ¨æ€å¯¼å…¥
module_name = 'json'
json_module = importlib.import_module(module_name)

# åŠ¨æ€å¯¼å…¥å­æ¨¡å—
parse_module = importlib.import_module('urllib.parse')

# é‡æ–°åŠ è½½æ¨¡å—
importlib.reload(json_module)
```

### 8. ç‰¹æ®Šå¯¼å…¥æ¨¡å¼

#### 8.1 å»¶è¿Ÿå¯¼å…¥
```python
def get_numpy():
    """å»¶è¿Ÿå¯¼å…¥numpy"""
    import numpy as np
    return np

def process_data(data):
    """åªæœ‰åœ¨éœ€è¦æ—¶æ‰å¯¼å…¥numpy"""
    np = get_numpy()
    return np.array(data)
```

#### 8.2 ä¸Šä¸‹æ–‡å¯¼å…¥
```python
class OptionalImport:
    def __init__(self, module_name):
        self.module_name = module_name
        self.module = None

    def __enter__(self):
        try:
            self.module = __import__(self.module_name)
            return self.module
        except ImportError:
            return None

    def __exit__(self, exc_type, exc_val, exc_tb):
        pass

# ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨
with OptionalImport('numpy') as np:
    if np:
        array = np.array([1, 2, 3])
    else:
        array = [1, 2, 3]
```

### 9. å¯¼å…¥è¯­å¥çš„æœ€ä½³å®è·µ

#### 9.1 å¯¼å…¥é¡ºåºï¼ˆPEP 8ï¼‰
```python
# 1. æ ‡å‡†åº“å¯¼å…¥
import os
import sys
from datetime import datetime

# 2. ç›¸å…³ç¬¬ä¸‰æ–¹åº“å¯¼å…¥
import numpy as np
import pandas as pd
import requests

# 3. æœ¬åœ°åº”ç”¨/åº“å¯¼å…¥
from . import local_module
from ..parent_package import parent_module
from myproject.utils import helper_function
```

#### 9.2 é¿å…çš„å¯¼å…¥æ¨¡å¼
```python
# âŒ é¿å…ï¼šé€šé…ç¬¦å¯¼å…¥
from module import *

# âŒ é¿å…ï¼šä¸€è¡Œå¯¼å…¥å¤šä¸ªæ¨¡å—
import os, sys, json

# âŒ é¿å…ï¼šä¸å¿…è¦çš„åˆ«å
import json as j  # jsonå·²ç»å¤ŸçŸ­äº†

# âœ… æ¨èï¼šæ˜ç¡®çš„å¯¼å…¥
from module import specific_function, SpecificClass
import json
import numpy as np  # çº¦å®šä¿—æˆçš„åˆ«å
```

## ğŸ” Pythonå¯¼å…¥æœºåˆ¶æ·±åº¦è§£æ

### å¯¼å…¥è¿‡ç¨‹çš„å››ä¸ªé˜¶æ®µ
æ•´ä¸ªimportè¿‡ç¨‹å¯ä»¥æ¦‚æ‹¬ä¸ºå››ä¸ªä¸»è¦é˜¶æ®µï¼š**æŸ¥æ‰¾ï¼ˆFindingï¼‰**ã€**åŠ è½½ï¼ˆLoadingï¼‰**ã€**æ‰§è¡Œï¼ˆExecutionï¼‰**å’Œ**ç»‘å®šï¼ˆBindingï¼‰**ã€‚

å…¶æ ¸å¿ƒç›®æ ‡æ˜¯ï¼š
1. æ‰¾åˆ°æ¨¡å—çš„æºä»£ç ï¼ˆæˆ–å­—èŠ‚ç ï¼‰
2. æ‰§è¡Œå®ƒä»¥åˆ›å»ºä¸€ä¸ª"æ¨¡å—å¯¹è±¡"
3. å°†å…¶æ”¾å…¥å…¨å±€ç¼“å­˜`sys.modules`
4. ç»‘å®šåˆ°æœ¬åœ°å˜é‡åä¸Š

### æ ¸å¿ƒå‚ä¸è€…

#### 1. sys.modules - æ¨¡å—ç¼“å­˜
```python
import sys

# sys.modulesæ˜¯å¯¼å…¥æœºåˆ¶çš„æ ¸å¿ƒç¼“å­˜
print(f"å·²ç¼“å­˜æ¨¡å—æ•°é‡: {len(sys.modules)}")
print("éƒ¨åˆ†å·²ç¼“å­˜æ¨¡å—:")
for name in list(sys.modules.keys())[:10]:
    print(f"  {name}")

# æ£€æŸ¥ç‰¹å®šæ¨¡å—æ˜¯å¦å·²ç¼“å­˜
if 'json' in sys.modules:
    print("jsonæ¨¡å—å·²åœ¨ç¼“å­˜ä¸­")
    print(f"æ¨¡å—å¯¹è±¡: {sys.modules['json']}")
```

#### 2. sys.path - æœç´¢è·¯å¾„
```python
import sys

print("æ¨¡å—æœç´¢è·¯å¾„:")
for i, path in enumerate(sys.path, 1):
    print(f"{i}. {path}")

# sys.pathé€šå¸¸åŒ…å«ï¼š
# 1. å½“å‰æ‰§è¡Œè„šæœ¬æ‰€åœ¨ç›®å½•
# 2. PYTHONPATHç¯å¢ƒå˜é‡æŒ‡å®šçš„ç›®å½•
# 3. Pythonå®‰è£…çš„é»˜è®¤è·¯å¾„ï¼ˆå¦‚site-packagesï¼‰
```

#### 3. æŸ¥æ‰¾å™¨ï¼ˆFindersï¼‰å’ŒåŠ è½½å™¨ï¼ˆLoadersï¼‰
```python
import sys

# æŸ¥çœ‹å…ƒè·¯å¾„æŸ¥æ‰¾å™¨
print("å…ƒè·¯å¾„æŸ¥æ‰¾å™¨:")
for finder in sys.meta_path:
    print(f"  {finder}")

# æŸ¥çœ‹è·¯å¾„é’©å­
print(f"è·¯å¾„é’©å­æ•°é‡: {len(sys.path_hooks)}")
```

### è¯¦ç»†å¯¼å…¥æµç¨‹ï¼šPythonä¼ªä»£ç æ¨¡æ‹Ÿ
ä¸ºäº†æ›´å…·ä½“åœ°ç†è§£å¯¼å…¥è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€æ®µPythonä»£ç æ¥æ¨¡æ‹Ÿ `import` çš„æ ¸å¿ƒé€»è¾‘ã€‚è¿™ä¸ªæ¨¡æ‹Ÿè¿‡ç¨‹æ•´åˆäº†æŸ¥æ‰¾ã€åŠ è½½å’Œæ‰§è¡Œçš„æ­¥éª¤ã€‚

```python
import sys
import os
from types import ModuleType

def simulate_import(module_name):
    """
    ç”¨Pythonä¼ªä»£ç æ¨¡æ‹Ÿæ¨¡å—å¯¼å…¥çš„å®Œæ•´æ ¸å¿ƒæµç¨‹ã€‚
    """
    print(f"--- å¼€å§‹å¯¼å…¥æ¨¡å—: {module_name} ---")

    # ----------------------------------------------------------------------
    # æ­¥éª¤ 1: æ£€æŸ¥æ¨¡å—ç¼“å­˜ (sys.modules)
    # ----------------------------------------------------------------------
    # è¿™æ˜¯Pythonåšçš„ç¬¬ä¸€ä»¶äº‹ã€‚å¦‚æœæ¨¡å—å·²ç»å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œç›´æ¥è¿”å›å®ƒã€‚
    # è¿™ç¡®ä¿äº†æ¨¡å—ä»£ç åªæ‰§è¡Œä¸€æ¬¡ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰ï¼Œå¹¶èƒ½å¤„ç†å¾ªç¯å¯¼å…¥çš„æŸäº›æƒ…å†µã€‚
    if module_name in sys.modules:
        print(f"âœ… æ­¥éª¤1: åœ¨ sys.modules ç¼“å­˜ä¸­æ‰¾åˆ° {module_name}ï¼Œç›´æ¥è¿”å›ã€‚")
        return sys.modules[module_name]
    print(f"â¡ï¸ æ­¥éª¤1: {module_name} ä¸åœ¨ç¼“å­˜ä¸­ï¼Œç»§ç»­æŸ¥æ‰¾ã€‚")

    # ----------------------------------------------------------------------
    # æ­¥éª¤ 2: æŸ¥æ‰¾æ¨¡å— (Finding)
    # ----------------------------------------------------------------------
    # Pythonä¼šéå† sys.meta_path ä¸­çš„â€œæŸ¥æ‰¾å™¨â€(Finder)æ¥å®šä½æ¨¡å—ã€‚
    # è¿™é‡Œæˆ‘ä»¬æ¨¡æ‹Ÿæœ€å¸¸è§çš„ PathFinderï¼Œå®ƒä¼šéå† sys.path ä¸­çš„è·¯å¾„ã€‚
    module_path = None
    is_package = False

    # æ£€æŸ¥æ˜¯å¦æ˜¯å†…ç½®æ¨¡å—
    if module_name in sys.builtin_module_names:
        print(f"â¡ï¸ æ­¥éª¤2: {module_name} æ˜¯ä¸€ä¸ªå†…ç½®æ¨¡å—ã€‚")
        # å†…ç½®æ¨¡å—ç”±Cè¯­è¨€å®ç°ï¼ŒåŠ è½½æ–¹å¼ä¸åŒï¼Œè¿™é‡Œç®€åŒ–å¤„ç†ã€‚
        spec = {"path": "built-in", "is_package": False}
    else:
        print(f"â¡ï¸ æ­¥éª¤2: åœ¨ sys.path ä¸­æœç´¢ {module_name}...")
        for path in sys.path:
            # å°è¯•ä½œä¸ºåŒ…æŸ¥æ‰¾ (ç›®å½• + __init__.py)
            package_path = os.path.join(path, module_name)
            init_file = os.path.join(package_path, "__init__.py")
            if os.path.isdir(package_path) and os.path.exists(init_file):
                module_path = init_file
                is_package = True
                print(f"  - æ‰¾åˆ°åŒ…: {module_path}")
                break
            
            # å°è¯•ä½œä¸ºæ¨¡å—æŸ¥æ‰¾ (.py æ–‡ä»¶)
            file_path = os.path.join(path, f"{module_name}.py")
            if os.path.exists(file_path):
                module_path = file_path
                is_package = False
                print(f"  - æ‰¾åˆ°æ¨¡å—æ–‡ä»¶: {module_path}")
                break
        
        if module_path is None:
            print(f"âŒ æ­¥éª¤2: æŸ¥æ‰¾å¤±è´¥ï¼åœ¨æ‰€æœ‰ sys.path è·¯å¾„ä¸­éƒ½æœªæ‰¾åˆ° {module_name}ã€‚")
            raise ImportError(f"No module named '{module_name}'")

    # ç°ä»£Pythonä¸­ï¼Œæ‰¾åˆ°çš„ç»“æœæ˜¯ä¸€ä¸ªâ€œæ¨¡å—è§„èŒƒâ€(spec)ï¼ŒåŒ…å«äº†åŠ è½½æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚
    spec = {
        "name": module_name,
        "path": module_path,
        "is_package": is_package
    }
    print(f"âœ… æ­¥éª¤2: æŸ¥æ‰¾æˆåŠŸï¼æ¨¡å—è§„èŒƒ: {spec}")

    # ----------------------------------------------------------------------
    # æ­¥éª¤ 3: åŠ è½½å’Œæ‰§è¡Œæ¨¡å— (Loading & Execution)
    # ----------------------------------------------------------------------
    # 1. æ ¹æ®è§„èŒƒåˆ›å»ºä¸€ä¸ªæ–°çš„ã€ç©ºçš„æ¨¡å—å¯¹è±¡ã€‚
    module = ModuleType(module_name)
    module.__file__ = spec["path"]
    module.__name__ = spec["name"]
    if spec["is_package"]:
        module.__path__ = [os.path.dirname(spec["path"])]
        module.__package__ = spec["name"]
    else:
        module.__package__ = spec["name"].rpartition('.')[0]
    
    print(f"â¡ï¸ æ­¥éª¤3: åˆ›å»ºäº†ç©ºçš„æ¨¡å—å¯¹è±¡: {module}")

    # 2. **å…³é”®æ­¥éª¤**ï¼šåœ¨æ‰§è¡Œä»£ç å‰ï¼Œç«‹å³å°†æ–°æ¨¡å—æ”¾å…¥ç¼“å­˜ã€‚
    #    è¿™æ˜¯Pythonè§£å†³å¾ªç¯å¯¼å…¥é—®é¢˜çš„æ ¸å¿ƒæœºåˆ¶ã€‚å¦‚æœå…¶ä»–æ¨¡å—åœ¨æ­¤æ—¶å¯¼å…¥æœ¬æ¨¡å—ï¼Œ
    #    å®ƒä»¬ä¼šä»ç¼“å­˜ä¸­è·å–è¿™ä¸ªï¼ˆè™½ç„¶å°šä¸å®Œæ•´ï¼‰çš„æ¨¡å—å¯¹è±¡ï¼Œè€Œä¸æ˜¯é‡æ–°å¯¼å…¥ã€‚
    sys.modules[module_name] = module
    print(f"  - **é‡è¦**: å·²å°†ä¸å®Œæ•´çš„ {module_name} æ”¾å…¥ sys.modules ç¼“å­˜ä»¥åº”å¯¹å¾ªç¯å¯¼å…¥ã€‚")

    # 3. è¯»å–å¹¶æ‰§è¡Œæ¨¡å—ä»£ç ã€‚
    #    æ¨¡å—ä¸­çš„æ‰€æœ‰é¡¶å±‚ä»£ç ï¼ˆå‡½æ•°å®šä¹‰ã€ç±»å®šä¹‰ã€å˜é‡èµ‹å€¼ã€æ‰“å°ç­‰ï¼‰éƒ½ä¼šåœ¨æ­¤æ—¶æ‰§è¡Œã€‚
    #    ä»£ç åœ¨ä¸€ä¸ªç‹¬ç«‹çš„ã€å±äºè¯¥æ¨¡å—çš„å‘½åç©ºé—´ä¸­æ‰§è¡Œã€‚
    try:
        print(f"  - å¼€å§‹æ‰§è¡Œæ¨¡å—ä»£ç : {module.__file__}...")
        with open(module.__file__, 'r', encoding='utf-8') as f:
            code = f.read()
        # exec() åœ¨æŒ‡å®šçš„å‘½åç©ºé—´(module.__dict__)ä¸­æ‰§è¡Œä»£ç 
        exec(code, module.__dict__)
        print(f"  - æ¨¡å—ä»£ç æ‰§è¡Œå®Œæ¯•ã€‚")
    except Exception as e:
        # 4. å¦‚æœæ‰§è¡Œå¤±è´¥ï¼Œå¿…é¡»ä»ç¼“å­˜ä¸­ç§»é™¤ï¼Œé˜²æ­¢ç•™ä¸‹ä¸€ä¸ªæŸåçš„æ¨¡å—ã€‚
        print(f"âŒ æ­¥éª¤3: æ‰§è¡Œæ¨¡å— {module_name} ä»£ç æ—¶å‡ºé”™: {e}")
        if module_name in sys.modules:
            del sys.modules[module_name]
        raise
    
    print(f"âœ… æ­¥éª¤3: æ¨¡å—åŠ è½½å’Œæ‰§è¡ŒæˆåŠŸï¼")
    print(f"--- æ¨¡å— {module_name} å¯¼å…¥å®Œæˆ ---")
    return module

# ----------------------------------------------------------------------
# æ­¥éª¤ 4: ç»‘å®šåç§° (Binding)
# ----------------------------------------------------------------------
# `simulate_import` å‡½æ•°è¿”å›äº†å®Œæ•´çš„æ¨¡å—å¯¹è±¡ã€‚
# çœŸæ­£çš„ `import` è¯­å¥æ¥ä¸‹æ¥ä¼šæŠŠè¿™ä¸ªå¯¹è±¡ç»‘å®šåˆ°å½“å‰ä½œç”¨åŸŸçš„å˜é‡åä¸Šã€‚
# ä¾‹å¦‚:
# `import math` ç­‰ä»·äº `math = simulate_import('math')`
# `import numpy as np` ç­‰ä»·äº `np = simulate_import('numpy')`
# `from os import path` é¦–å…ˆæ‰§è¡Œ `_temp = simulate_import('os')`ï¼Œç„¶å `path = _temp.path`
# è¿™ä¸€æ­¥æ˜¯ç”±Pythonè§£é‡Šå™¨åœ¨å¤„ç†importè¯­å¥æ—¶å®Œæˆçš„ï¼Œè€Œä¸æ˜¯åœ¨å¯¼å…¥å‡½æ•°å†…éƒ¨ã€‚

> **ä¼ªä»£ç çš„ç®€åŒ–ä¹‹å¤„ï¼š**
> ä¸Šè¿°ä¼ªä»£ç ä¸ºäº†æ¸…æ™°åœ°å±•ç¤ºæ ¸å¿ƒæµç¨‹ï¼Œç®€åŒ–äº†å®é™…çš„å¯¼å…¥æœºåˆ¶ã€‚ä¾‹å¦‚ï¼Œå®ƒæ²¡æœ‰å®Œå…¨æ¨¡æ‹Ÿ`sys.meta_path`ä¸­æŸ¥æ‰¾å™¨(Finder)å’ŒåŠ è½½å™¨(Loader)çš„å¤æ‚äº¤äº’ï¼Œä¹Ÿ**æœªå¤„ç†ç›¸å¯¹å¯¼å…¥**ã€‚å¤„ç†ç›¸å¯¹å¯¼å…¥æ—¶ï¼Œè§£é‡Šå™¨éœ€è¦çŸ¥é“å½“å‰æ¨¡å—çš„`__package__`å±æ€§ï¼Œä»¥ä¾¿å°†`.`æˆ–`..`è¿™æ ·çš„ç›¸å¯¹è·¯å¾„è§£æä¸ºå®Œæ•´çš„ç»å¯¹æ¨¡å—è·¯å¾„ã€‚ä¾‹å¦‚ï¼Œåœ¨`my_pkg.utils`æ¨¡å—ä¸­é‡åˆ°`from . import helpers`ï¼Œè§£é‡Šå™¨ä¼šå°†å…¶è§£æä¸ºå¯¹`my_pkg.helpers`çš„å¯¼å…¥ã€‚
```

### å¾ªç¯å¯¼å…¥çš„å¤„ç†æœºåˆ¶
```python
# æ¼”ç¤ºå¾ªç¯å¯¼å…¥å¦‚ä½•è¢«å¤„ç†
# module_a.py
print("å¼€å§‹æ‰§è¡Œ module_a")
import module_b  # æ­¤æ—¶ module_a å·²åœ¨ sys.modules ä¸­
print("module_a æ‰§è¡Œå®Œæˆ")

# module_b.py
print("å¼€å§‹æ‰§è¡Œ module_b")
import module_a  # ä» sys.modules ä¸­ç›´æ¥è·å–ï¼ˆéƒ¨åˆ†åˆå§‹åŒ–çš„ï¼‰module_a
print("module_b æ‰§è¡Œå®Œæˆ")
```

**å¤„ç†æœºåˆ¶**ï¼š
1. `module_a`å¼€å§‹å¯¼å…¥ï¼Œåˆ›å»ºç©ºæ¨¡å—å¯¹è±¡å¹¶æ”¾å…¥ç¼“å­˜
2. æ‰§è¡Œ`module_a`ä»£ç æ—¶é‡åˆ°`import module_b`
3. `module_b`å¼€å§‹å¯¼å…¥ï¼Œåˆ›å»ºç©ºæ¨¡å—å¯¹è±¡å¹¶æ”¾å…¥ç¼“å­˜
4. æ‰§è¡Œ`module_b`ä»£ç æ—¶é‡åˆ°`import module_a`
5. ä»ç¼“å­˜ä¸­æ‰¾åˆ°`module_a`ï¼ˆè™½ç„¶è¿˜æœªå®Œå…¨åˆå§‹åŒ–ï¼‰ï¼Œç›´æ¥è¿”å›
6. `module_b`æ‰§è¡Œå®Œæˆ
7. å›åˆ°`module_a`ç»§ç»­æ‰§è¡Œå®Œæˆ

## ğŸ”„ åŠ¨æ€å¯¼å…¥

### ä½¿ç”¨ importlib
```python
import importlib

# åŠ¨æ€å¯¼å…¥æ¨¡å—
module_name = 'math'
math_module = importlib.import_module(module_name)
print(math_module.pi)  # 3.141592653589793

# é‡æ–°åŠ è½½æ¨¡å—ï¼ˆå¼€å‘æ—¶æœ‰ç”¨ï¼‰
importlib.reload(math_module)

# åŠ¨æ€å¯¼å…¥åŒ…ä¸­çš„æ¨¡å—
json_module = importlib.import_module('json')
data = json_module.dumps({'key': 'value'})
```

### ä½¿ç”¨ __import__
```python
# åŠ¨æ€å¯¼å…¥ï¼ˆä¸æ¨èï¼Œä½¿ç”¨importlibä»£æ›¿ï¼‰
math_module = __import__('math')
print(math_module.sqrt(16))  # 4.0

# å¯¼å…¥åŒ…ä¸­çš„æ¨¡å—
os_path = __import__('os.path', fromlist=[''])
print(os_path.exists('test.txt'))
```

## âš ï¸ å¯¼å…¥çš„æ³¨æ„äº‹é¡¹

### 1. é¿å…å¾ªç¯å¯¼å…¥
å¾ªç¯å¯¼å…¥æ˜¯Pythonåˆå­¦è€…æœ€å¸¸é‡åˆ°çš„é—®é¢˜ä¹‹ä¸€ã€‚å½“ä¸¤ä¸ªæˆ–å¤šä¸ªæ¨¡å—äº’ç›¸å¯¼å…¥å¯¹æ–¹æ—¶ï¼Œå°±ä¼šå‘ç”Ÿå¾ªç¯å¯¼å…¥ï¼Œé€šå¸¸ä¼šå¯¼è‡´ `ImportError` æˆ– `AttributeError`ã€‚

**å…¸å‹åœºæ™¯ï¼š**
```python
# æ¨¡å—a: a.py
import b  # å°è¯•å¯¼å…¥b

class A:
    def method(self):
        return b.B()

# æ¨¡å—b: b.py
import a  # å°è¯•å¯¼å…¥aï¼Œå½¢æˆå¾ªç¯

class B:
    def method(self):
        return a.A()
```
å½“ä½ å°è¯•è¿è¡Œ `import a` æ—¶ï¼ŒPythonè§£é‡Šå™¨ä¼šé™·å…¥ä¸€ä¸ªæ­»å¾ªç¯ï¼Œå¹¶æœ€ç»ˆå¤±è´¥ã€‚

**è§£å†³æ–¹æ¡ˆï¼š**

#### æ–¹æ¡ˆ1: å»¶è¿Ÿå¯¼å…¥ (å±€éƒ¨å¯¼å…¥)
å°† `import` è¯­å¥ç§»åˆ°éœ€è¦ä½¿ç”¨å®ƒçš„å‡½æ•°æˆ–æ–¹æ³•å†…éƒ¨ã€‚è¿™å¯ä»¥æ‰“ç ´åœ¨æ¨¡å—åŠ è½½æ—¶äº§ç”Ÿçš„å¾ªç¯ã€‚

```python
# a.py
class A:
    def method(self):
        import b  # åœ¨æ–¹æ³•å†…éƒ¨å¯¼å…¥
        return b.B()

# b.py
class B:
    def method(self):
        import a  # åœ¨æ–¹æ³•å†…éƒ¨å¯¼å…¥
        return a.A()
```
**ä¼˜ç‚¹**ï¼šä¿®æ”¹ç®€å•å¿«æ·ã€‚
**ç¼ºç‚¹**ï¼šä¸ç¬¦åˆPEP 8è§„èŒƒï¼ˆimportåº”åœ¨æ–‡ä»¶é¡¶éƒ¨ï¼‰ï¼Œå¯èƒ½ä¼šæ©ç›–æ›´æ·±å±‚æ¬¡çš„è®¾è®¡é—®é¢˜ã€‚

#### æ–¹æ¡ˆ2: ä»£ç é‡æ„ (æœ€ä½³æ–¹æ¡ˆ)
è¿™æ˜¯è§£å†³å¾ªç¯å¯¼å…¥æœ€æ¨èã€æœ€å½»åº•çš„æ–¹æ³•ã€‚é€šè¿‡å¼•å…¥ç¬¬ä¸‰ä¸ªæ¨¡å—æ¥ç®¡ç†å…±äº«çš„ä¾èµ–ï¼Œæ‰“ç ´å¾ªç¯ã€‚

**é‡æ„å‰:**
- `order.py` (è®¢å•æ¨¡å—) ä¾èµ– `customer.py` è·å–å®¢æˆ·ä¿¡æ¯ã€‚
- `customer.py` (å®¢æˆ·æ¨¡å—) ä¾èµ– `order.py` è·å–å®¢æˆ·çš„è®¢å•åˆ—è¡¨ã€‚

```python
# âŒ é‡æ„å‰: order.py
from customer import Customer

class Order:
    def __init__(self, customer_id):
        self.customer = Customer.get(customer_id)

# âŒ é‡æ„å‰: customer.py
from order import Order

class Customer:
    def get_orders(self):
        # ...è·å–è¯¥å®¢æˆ·çš„æ‰€æœ‰è®¢å•...
        return [Order(...)]
```

**é‡æ„å:**
åˆ›å»ºä¸€ä¸ª `models.py` (æˆ– `shared.py`) æ¥å­˜æ”¾å…±äº«çš„æ•°æ®æ¨¡å‹æˆ–æ¥å£ï¼Œè®© `order` å’Œ `customer` éƒ½ä¾èµ–å®ƒã€‚

```python
# âœ… é‡æ„å: models.py (æ–°çš„å…±äº«æ¨¡å—)
class Order:
    # ... Orderç±»çš„å®šä¹‰ ...
    pass

class Customer:
    # ... Customerç±»çš„å®šä¹‰ ...
    pass

# âœ… é‡æ„å: order_service.py (åŸorder.pyçš„åŠŸèƒ½)
from models import Customer, Order

def create_order(customer_id):
    customer = Customer.get(customer_id)
    # ...
    return Order(...)

# âœ… é‡æ„å: customer_service.py (åŸcustomer.pyçš„åŠŸèƒ½)
from models import Customer, Order

def get_customer_orders(customer_id):
    customer = Customer.get(customer_id)
    # ...
    return [Order(...)]
```
**ä¼˜ç‚¹**ï¼šè®¾è®¡æ›´æ¸…æ™°ï¼ŒèŒè´£æ›´åˆ†æ˜ï¼Œä»æ ¹æœ¬ä¸Šè§£å†³äº†å¾ªç¯ä¾èµ–ã€‚
**ç¼ºç‚¹**ï¼šéœ€è¦å¯¹ä»£ç ç»“æ„è¿›è¡Œæ›´æ·±å…¥çš„æ€è€ƒå’Œä¿®æ”¹ã€‚

### 2. é¿å…ä½¿ç”¨ from module import *
```python
# ä¸å¥½çš„åšæ³•
from math import *
from numpy import *  # å¯èƒ½è¦†ç›–mathä¸­çš„å‡½æ•°

# å¥½çš„åšæ³•
import math
import numpy as np

# æˆ–è€…æ˜ç¡®å¯¼å…¥éœ€è¦çš„å‡½æ•°
from math import pi, sqrt
from numpy import array, zeros
```

### 3. å¯¼å…¥é¡ºåºè§„èŒƒ
æŒ‰ç…§PEP 8è§„èŒƒï¼Œå¯¼å…¥åº”è¯¥æŒ‰ä»¥ä¸‹é¡ºåºï¼š

```python
# 1. æ ‡å‡†åº“å¯¼å…¥
import os
import sys
from datetime import datetime

# 2. ç›¸å…³ç¬¬ä¸‰æ–¹åº“å¯¼å…¥
import numpy as np
import pandas as pd
import requests

# 3. æœ¬åœ°åº”ç”¨/åº“å¯¼å…¥
from . import local_module
from ..parent_package import parent_module
from myproject.utils import helper_function
```

## ğŸ”§ å¯¼å…¥ä¼˜åŒ–æŠ€å·§

### 1. åªå¯¼å…¥éœ€è¦çš„å†…å®¹
```python
# å¥½çš„åšæ³•
from collections import defaultdict, Counter
from datetime import datetime, timedelta

# ä¸å¥½çš„åšæ³•
import collections
import datetime
# ç„¶ååªä½¿ç”¨å…¶ä¸­çš„ä¸€ä¸¤ä¸ªåŠŸèƒ½
```

### 2. ä½¿ç”¨åˆé€‚çš„åˆ«å
```python
# å¸¸è§çš„çº¦å®šä¿—æˆçš„åˆ«å
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import tensorflow as tf
import torch.nn.functional as F

# é¿å…ä½¿ç”¨å®¹æ˜“æ··æ·†çš„åˆ«å
import numpy as n  # ä¸å¥½ï¼Œnå¤ªçŸ­å®¹æ˜“æ··æ·†
import pandas as p  # ä¸å¥½ï¼Œpå¯èƒ½æŒ‡å…¶ä»–ä¸œè¥¿
```

### 3. å»¶è¿Ÿå¯¼å…¥
```python
def process_data():
    # åªæœ‰åœ¨éœ€è¦æ—¶æ‰å¯¼å…¥é‡å‹åº“
    import pandas as pd
    import numpy as np
    
    # å¤„ç†æ•°æ®çš„ä»£ç 
    pass

# æˆ–è€…åœ¨æ¨¡å—çº§åˆ«ä½¿ç”¨æ¡ä»¶å¯¼å…¥
def get_processor():
    try:
        import pandas as pd
        return pd.DataFrame
    except ImportError:
        # æä¾›å¤‡é€‰æ–¹æ¡ˆ
        return list
```

## ğŸ“Š å¯¼å…¥æ€§èƒ½è€ƒè™‘

### å¯¼å…¥æ—¶é—´æµ‹è¯•
```python
import time

# æµ‹è¯•å¯¼å…¥æ—¶é—´
start_time = time.time()
import numpy as np
end_time = time.time()
print(f"å¯¼å…¥numpyè€—æ—¶: {end_time - start_time:.4f}ç§’")

# æµ‹è¯•å¤šæ¬¡å¯¼å…¥ï¼ˆç¬¬äºŒæ¬¡ä¼šå¾ˆå¿«ï¼Œå› ä¸ºæœ‰ç¼“å­˜ï¼‰
start_time = time.time()
import numpy as np  # ç¬¬äºŒæ¬¡å¯¼å…¥
end_time = time.time()
print(f"ç¬¬äºŒæ¬¡å¯¼å…¥numpyè€—æ—¶: {end_time - start_time:.6f}ç§’")
```

### å‡å°‘å¯¼å…¥å¼€é”€
```python
# åœ¨å‡½æ•°å†…éƒ¨å¯¼å…¥ï¼Œåªæœ‰è°ƒç”¨æ—¶æ‰å¯¼å…¥
def heavy_computation():
    import scipy.optimize  # åªæœ‰éœ€è¦æ—¶æ‰å¯¼å…¥
    # æ‰§è¡Œè®¡ç®—
    pass

# ä½¿ç”¨æ‡’åŠ è½½
class DataProcessor:
    def __init__(self):
        self._pandas = None
    
    @property
    def pandas(self):
        if self._pandas is None:
            import pandas as pd
            self._pandas = pd
        return self._pandas
```

## ğŸ¯ æœ¬èŠ‚å°ç»“

### å¯¼å…¥è¯­å¥çš„ä¸°å¯Œç»„åˆ
Pythonæä¾›äº†éå¸¸çµæ´»çš„å¯¼å…¥è¯­å¥ç»„åˆï¼š
- **åŸºæœ¬å¯¼å…¥**ï¼š`import module`ã€`import module as alias`
- **é€‰æ‹©æ€§å¯¼å…¥**ï¼š`from module import item`ã€`from module import item as alias`
- **ç›¸å¯¹å¯¼å…¥**ï¼š`.`ã€`..`ã€`...`ç”¨äºåŒ…å†…å¯¼å…¥
- **æ¡ä»¶å¯¼å…¥**ï¼šåŸºäºå¼‚å¸¸å¤„ç†ã€ç‰ˆæœ¬æ£€æµ‹ã€å¹³å°æ£€æµ‹
- **åŠ¨æ€å¯¼å…¥**ï¼š`__import__()`ã€`importlib.import_module()`

### Pythonå¯¼å…¥æœºåˆ¶çš„å››ä¸ªé˜¶æ®µ
1. **æŸ¥æ‰¾ï¼ˆFindingï¼‰**ï¼šåœ¨sys.pathä¸­æœç´¢æ¨¡å—æ–‡ä»¶
2. **åŠ è½½ï¼ˆLoadingï¼‰**ï¼šåˆ›å»ºæ¨¡å—å¯¹è±¡å¹¶è¯»å–æºä»£ç 
3. **æ‰§è¡Œï¼ˆExecutionï¼‰**ï¼šåœ¨æ¨¡å—å‘½åç©ºé—´ä¸­æ‰§è¡Œä»£ç 
4. **ç»‘å®šï¼ˆBindingï¼‰**ï¼šå°†æ¨¡å—å¯¹è±¡ç»‘å®šåˆ°æœ¬åœ°å˜é‡

### å…³é”®æœºåˆ¶
- **sys.modulesç¼“å­˜**ï¼šç¡®ä¿æ¨¡å—åªè¢«æ‰§è¡Œä¸€æ¬¡
- **æå‰ç¼“å­˜**ï¼šåœ¨æ‰§è¡Œå‰å°±æ”¾å…¥ç¼“å­˜ï¼Œè§£å†³å¾ªç¯å¯¼å…¥
- **å‘½åç©ºé—´éš”ç¦»**ï¼šæ¯ä¸ªæ¨¡å—æœ‰ç‹¬ç«‹çš„å‘½åç©ºé—´
- **æœç´¢è·¯å¾„**ï¼šsys.pathå†³å®šæ¨¡å—æŸ¥æ‰¾é¡ºåº

### æœ€ä½³å®è·µè¦ç‚¹
- éµå¾ªPEP 8çš„å¯¼å…¥é¡ºåºè§„èŒƒ
- é¿å…é€šé…ç¬¦å¯¼å…¥å’Œå¾ªç¯å¯¼å…¥
- ä½¿ç”¨æ¡ä»¶å¯¼å…¥å¤„ç†å¯é€‰ä¾èµ–
- åˆç†ä½¿ç”¨åˆ«åæé«˜ä»£ç å¯è¯»æ€§

## ğŸ“š ä¸‹ä¸€æ­¥å­¦ä¹ 
å­¦ä¹ å®Œæ¨¡å—å¯¼å…¥åï¼Œæ¥ä¸‹æ¥å­¦ä¹  **[03-åˆ›å»ºæ¨¡å—.md](./03-åˆ›å»ºæ¨¡å—.md)**ï¼Œäº†è§£å¦‚ä½•åˆ›å»ºè‡ªå·±çš„æ¨¡å—ã€‚
